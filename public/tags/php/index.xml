<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>phponRandom Geekery</title>
    <link>https://randomgeekery.org/tags/php/</link>
    <description>
      Recent contentinphp on Random Geekery
    </description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
      
      <lastBuildDate>Fri, 14 Aug 2015 00:00:00 -0700</lastBuildDate><atom:link href="https://randomgeekery.org/tags/php/index.xml" rel="self" type="application/rss+xml" /><item>
  <title>Post: PHP, for Some Reason</title>
  <link>https://randomgeekery.org/post/2015/08/php-for-some-reason/</link>
  <pubDate>Fri, 14 Aug 2015 00:00:00 -0700</pubDate>
  
  <guid>https://randomgeekery.org/post/2015/08/php-for-some-reason/</guid>
  <description>&lt;p&gt;I have been looking at &lt;a href=&#34;https://randomgeekery.org/card/php/&#34;&gt;PHP&lt;/a&gt; for the first time in years. I don’t know why.&lt;/p&gt;</description>
   <category>post</category> 
   <category>post</category> 
   <category>php</category>  <category>programming</category> 
  <content:encoded><![CDATA[<h2>I have been looking at PHP for the first time in years. I don't know why.
</h2><p>I have been looking at <a href="/card/php/">PHP</a> for the first time in years. I don&rsquo;t know why.</p>
<p>Let&rsquo;s blame <a href="http://funkatron.com/">Ed Finkler</a>. I started following him online because of his <a href="http://funkatron.com/osmi/">Open Sourcing Mental Illness</a> work and talks. He also talks about programming languages, and this exposed me to interesting things happening in the PHP world.</p>
<ul>
<li>PHP practice guidelines exist now! <a href="http://joshlockhart.com/">Josh Lockhart</a>&rsquo;s <a href="http://www.phptherightway.com/">PHP: The Right Way</a> project and <a href="http://shop.oreilly.com/product/0636920033868.do">Modern PHP</a> book give better tips than the quick and dirty sites I recall from years past.</li>
<li><a href="https://getcomposer.org/">Composer</a> became the preferred PHP dependency management tool.</li>
<li><a href="http://laravel.com/">Laravel</a> looks like an interesting Web framework.</li>
<li>For visual learning, there are the <a href="https://laracasts.com/">Laracasts</a> a series of video lessons about Laravel, PHP, and other tools.</li>
</ul>
<p>Topping off the strange PHP interest: I registered for <a href="http://www.pnwphp.com/">Pacific Northwest PHP</a>, which will be held here in Seattle next month. Of course I&rsquo;m looking forward to Ed Finkler&rsquo;s talk, but several of the talks interest me.</p>
<p>So I&rsquo;ll be going to that. And best of all, at the end of the day I&rsquo;ll just go home rather than to a hotel.</p>
<p>My last serious PHP code-writing project was six years ago. Even then it had been a long time since PHP was my primary development language. I&rsquo;m curious to play with versions 5.6 and 7.</p>
<p>I put together a <a href="http://laravel.com/docs/5.1/homestead">Homestead</a> instance in Vagrant. The next step for me is probably the <a href="https://laracasts.com/series/object-oriented-bootcamp-in-php">laracast series on PHP objects</a>. It&rsquo;s been long enough that I don&rsquo;t remember what a PHP object looks like anymore.</p>
<p>And yes, I&rsquo;m familiar with the <a href="http://eev.ee/blog/2012/04/09/php-a-fractal-of-bad-design/">PHP: a fractal of bad design</a> piece. I agreed with every point made in it. Some little bits have changed, but PHP is not Python. It never will be. But I&rsquo;ve given up on hating PHP. PHP is a cockroach. The last Web servers will be running PHP. May as well poke at it a little bit. That&rsquo;s the sort of thing I do.</p>]]></content:encoded>
</item>
<item>
  <title>Post: PHP Buzz Stream Reader</title>
  <link>https://randomgeekery.org/post/2010/03/php-buzz-stream-reader/</link>
  <pubDate>Fri, 12 Mar 2010 00:00:00 -0800</pubDate>
  
  <guid>https://randomgeekery.org/post/2010/03/php-buzz-stream-reader/</guid>
  <description>2020-03-13
Of course, Google long ago turned Buzz into Plus, then abandoned that. Keeping the content here in case some fragment of the PHP can be useful to others.
Why and What? Recently I updated the site so that it would summarize the latest posts from my blog. The motive is simple: my site does not get updated often, so data should be piped in from elsewhere to reassure people that I have not died in the middle of writing Parrot Babystep 09.</description>
   <category>post</category> 
   <category>post</category> 
   <category>php</category>  <category>coolnamehere</category> 
  <content:encoded><![CDATA[<blockquote>
<p><strong>2020-03-13</strong></p>
<p>Of course, Google long ago turned Buzz into <a href="https://plus.google.com/">Plus</a>, then abandoned <em>that</em>. Keeping the content here in case some fragment of the <a href="/card/php/">PHP</a> can be useful to others.</p>
</blockquote>
<h2 id="why-and-what">Why and What?</h2>
<p>Recently I updated the site so that it would summarize the latest posts
from my blog. The motive is simple: my site does not get updated often,
so data should be piped in from elsewhere to reassure people that I have
not died in the middle of writing Parrot Babystep 09.</p>
<p>The blog summary works. It’s nice. It’s pretty. Well, it’s pretty enough
for me. The problem is that I am not the world’s most prolific blogger.
I can write a lot, and I can write a little. The in-between world of
blogs is uncomfortable territory for me. As a result, that nifty little
summary only makes me look a little bit less dead than the old static
update system I used.</p>
<p>What about a <a href="http://twitter.com">Twitter</a> feed? That is easy enough,
but the problem with Twitter feeds is that you get no context. I might
be teasing a fellow Tweeter with <a href="http://foursquare.com">foursquare</a>
jokes, but if you don’t know him and his seething hatred of all things
foursquare then my commentary will seem nonsensical at best.</p>
<p>Besides, I haven’t been using Twitter quite as much recently. I’m on to
the next shiny thing: <a href="https://en.wikipedia.org/wiki/Google_Buzz">Google
Buzz</a>. It provides the
instant gratification of Twitter, along with a system for commenting,
liking, geolocation, sharing links, and more. It’s sort of like
<a href="http://facebook.com">Facebook</a>, except that it’s embedded into GMail
and there’s no Mafia Wars yet.</p>
<p>I’ve been <a href="http://www.google.com/profiles/brian.wisti#buzz">buzzing rather
frequently</a>. I even
have my blog and <a href="http://www.flickr.com/photos/brianwisti/">Flickr</a>
activity fed into Buzz, so my Buzz stream includes anything from either
of those.</p>
<h2 id="how">How?</h2>
<p>Let me throw an immediate disclaimer by saying that 80% of what I want
is already implemented in the <a href="http://www.moretechtips.net/2010/02/google-buzz-widget-jquery-plugin.html">Google Buzz
Widget</a>,
a jQuery plugin which displays the contents of your Buzz stream. I tried
it out, and it worked like a charm.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://google-buzz-widget.googlecode.com/files/jquery.google-buzz-1.0.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.my-buzz&#39;</span><span class="p">).</span><span class="nx">googleBuzz</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">username</span><span class="o">:</span><span class="s1">&#39;brian.wisti&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">n</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">show_n</span><span class="o">:</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;my-buzz&#34;</span><span class="p">&gt;</span>loading..<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></span></span></code></pre>
</figure><p>A little CSS fiddling, and voila!</p>
<p><img src="/post/2010/03/attachments/img/2010/buzz-widget.png" title="Google Buzz Widget Image" alt="Google Buzz Widget Image"/></p>
<p>The only thing is that some stuff I really want sits in the other 20%:</p>
<ul>
<li>the (admittedly lightweight) formatting from the original Buzz</li>
<li>the links I share</li>
<li>the images I post to Flickr.</li>
</ul>
<p>I don’t blame the Google Buzz Widget for not having that information. It
uses a Google service which does not yet provide those details. To get
at that information <em>today</em> I’ll need to directly access the original
feed, not the feed as translated by a service. Since I’m the sort of guy
that enjoys reinventing wheels, I’ll put something together myself.</p>
<p>My site runs on a shared host, and the freshest language available to me
on that host is <a href="http://php.net">PHP</a>. I’m not a huge fan of the
language, but I am pragmatic. If the most convenient tool available is
PHP, then that’s what I’ll use.</p>
<p>If they had <a href="http://modperlite.org">mod_perlite</a>, it would be a
significantly different story. Oh well. Let’s begin.</p>
<h2 id="start">Start!</h2>
<p>The initial local development will be on the home Mac, running OS X 10.5
and PHP 5.2.11. My Web host supports newer versions of PHP - all the way
up to 6 -but I’m not going to worry about it today.</p>
<h3 id="grab-my-own-copy-of-the-feed">Grab my own copy of the feed</h3>
<p>All right. I know for a fact that I’m going to be loading and
manipulating this data a <em>lot</em> during the initial stage of development.
I might as well grab a copy of the Buzz XML feed and work with it
locally. That will save a bit of time and network load. Hey, every
second counts.</p>
<p>Buzz feed URLs follow a simple pattern, with your username inserted at
the approproate place.</p>
<blockquote>
<p><code>http://buzz.googleapis.com/feeds/username/public/posted</code></p>
</blockquote>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >$ wget http://buzz.googleapis.com/feeds/brian.wisti/public/posted -O buzz.xml
...
2010-03-11 18:48:44 (754 KB/s) - `buzz.xml` saved [92972]</code></pre>
</figure><h3 id="parse-and-print">Parse and Print</h3>
<p>The first task is to parse the XML and display the results. I enjoy
<a href="http://php.net/manual/en/book.simplexml.php">SimpleXML</a> when handling
XML in PHP-land, since it hands back a reasonable data structure without
any fuss from me.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">dump</span><span class="p">(</span><span class="nv">$variable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$output</span> <span class="o">=</span> <span class="nx">htmlentities</span><span class="p">(</span><span class="nx">print_r</span><span class="p">(</span><span class="nv">$variable</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;&lt;pre&gt;</span><span class="si">$output</span><span class="s2">&lt;/pre&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;buzz.xml&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$buzz</span> <span class="o">=</span> <span class="nx">simplexml_load_file</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Printing this, because PHP chokes on the &#39;&lt;?xml&#39; Processing Instruction
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">print</span> <span class="s1">&#39;&lt;?xml version=&#34;1.0&#34;?&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!DOCTYPE html
</span></span></span><span class="line"><span class="cl"><span class="err">    PUBLIC &#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34;
</span></span></span><span class="line"><span class="cl"><span class="err">    &#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; xml:lang=&#34;en&#34; lang=&#34;en&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;title&gt;Buzz Stream Test&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;h1&gt;Buzz Stream Test&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo dump($buzz) ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/html&gt;
</span></span></span></code></pre>
</figure><p>The result is not exciting, but it does show that the XML is being
parsed. I have created a simple <code>dump</code> function which will come in handy
as I examine the information being displayed.</p>
<p><img src="/post/2010/03/attachments/img/2010/buzz-dump.png" title="Google Buzz dumped image" alt="Google Buzz dumped image"/></p>
<h3 id="show-entries">Show Entries</h3>
<p>Now I want to display the entries. How about I start by dumping them?</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">dump</span><span class="p">(</span><span class="nv">$variable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$output</span> <span class="o">=</span> <span class="nx">htmlentities</span><span class="p">(</span><span class="nx">print_r</span><span class="p">(</span><span class="nv">$variable</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;&lt;pre&gt;</span><span class="si">$output</span><span class="s2">&lt;/pre&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;buzz.xml&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$buzz</span> <span class="o">=</span> <span class="nx">simplexml_load_file</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Printing this, because PHP chokes on the &#39;&lt;?xml&#39; Processing Instruction
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">print</span> <span class="s1">&#39;&lt;?xml version=&#34;1.0&#34;?&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!DOCTYPE html
</span></span></span><span class="line"><span class="cl"><span class="err">    PUBLIC &#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34;
</span></span></span><span class="line"><span class="cl"><span class="err">    &#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; xml:lang=&#34;en&#34; lang=&#34;en&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;title&gt;Buzz Stream Test&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;h1&gt;Buzz Stream Test&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php foreach($buzz-&gt;entry as $entry): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo dump($entry) ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;hr /&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php endforeach ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/html&gt;
</span></span></span></code></pre>
</figure><p>This lets me focus on the structure of an entry, at least as far as
SimpleXML perceives it.</p>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >SimpleXMLElement Object
(
    [title] =&gt; Buzz by Brian Wisti from Buzz
    [summary] =&gt; Right. I set up a basic Buzz feed on my site using the jQuery Google Buzz Widget. It&#39;ll do while I&#39;m hacking together one of my own for a new PHP project page on coolnamehere. That section&#39;s been a bit neglected.
    [published] =&gt; 2010-03-11T08:04:37.000Z
    [updated] =&gt; 2010-03-11T08:04:37.626Z
    [id] =&gt; tag:google.com,2009:buzz/z135dd3bwnadctqp404cd1tqkrqpyjgrmtg0k
    [link] =&gt; Array
        (
            [0] =&gt; SimpleXMLElement Object
                (
                    [@attributes] =&gt; Array
                        (
                            [rel] =&gt; alternate
                            [type] =&gt; text/html
                            [href] =&gt; http://www.google.com/buzz/108694322269563399860/UYqMxptshCD/Right-I-set-up-a-basic-Buzz-feed-on-my-site-using
                        )

                )

            [1] =&gt; SimpleXMLElement Object
                (
                    [@attributes] =&gt; Array
                        (
                            [rel] =&gt; replies
                            [type] =&gt; application/atom&#43;xml
                            [href] =&gt; http://buzz.googleapis.com/feeds/108694322269563399860/comments/z135dd3bwnadctqp404cd1tqkrqpyjgrmtg0k
                        )

                )

        )

    [author] =&gt; SimpleXMLElement Object
        (
            [name] =&gt; Brian Wisti
            [uri] =&gt; http://www.google.com/profiles/brian.wisti
        )

    [content] =&gt; &lt;div&gt;Right. I set up a basic Buzz feed on my site using the jQuery Google Buzz Widget. It&amp;#39;ll do while I&amp;#39;m hacking together one of my own for a new PHP project page on coolnamehere. That section&amp;#39;s been a bit neglected.&lt;/div&gt;
)</code></pre>
</figure><p>Quite a few details are being missed because SimpleXML has its own
special tricks for handling namespaces, but a lot can be done before
that is a concern. Let’s look at the information that <em>is</em> readily
accessible and figure out what I can do with it.</p>
<dl>
<dt>title</dt>
<dd>The posting source is shown here (Buzz, Flickr, Mobile, etc.)</dd>
<dt>published</dt>
<dd>When the Buzz was posted</dd>
<dt>link</dt>
<dd>A collection of links associated with the buzz (the buzz itself,
posted links, images, replies, etc.)</dd>
<dt>content</dt>
<dd>The Buzz, formatted as an HTML fragment</dd>
</dl>
<p>Let’s do some simple formatting. I’m not sure what to do with the links
yet, so I’ll just <code>dump</code> them.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Buzz</span> <span class="nx">Stream</span> <span class="nx">Test</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;?</span><span class="nx">php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$buzz</span><span class="o">-&gt;</span><span class="na">entry</span> <span class="k">as</span> <span class="nv">$entry</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo $entry-&gt;content ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;p&gt;&lt;?php echo $entry-&gt;published ?&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;p&gt;&lt;?php echo $entry-&gt;title ?&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php foreach ($entry-&gt;link as $link): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;?php echo dump($link) ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php endforeach ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;?php endforeach ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/body&gt;
</span></span></span></code></pre>
</figure><p>So what does that get us?</p>
<aside class="admonition note">
<p class="admonition-title">Note</p>
<p>Oh that’s right. At one point this was a sort of cool direct embedding
of my Buzz debug run into the page. Wonder if I could find a capture at
<a href="https://archive.org">https://archive.org</a></p>
</aside>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;example&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>The sock begins<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>2010-03-10T07:22:09.000Z<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Buzz by Brian Wisti from Flickr<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>SimpleXMLElement Object
</span></span><span class="line"><span class="cl">(
</span></span><span class="line"><span class="cl">    [@attributes] =&gt; Array
</span></span><span class="line"><span class="cl">        (
</span></span><span class="line"><span class="cl">            [rel]  =&gt; alternate
</span></span><span class="line"><span class="cl">            [type] =&gt; text/html
</span></span><span class="line"><span class="cl">            [href] =&gt; http://www.google.com/buzz/108694322269563399860/PaTypwpxCkH/The-sock-begins
</span></span><span class="line"><span class="cl">        )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>SimpleXMLElement Object
</span></span><span class="line"><span class="cl">(
</span></span><span class="line"><span class="cl">    [@attributes] =&gt; Array
</span></span><span class="line"><span class="cl">        (
</span></span><span class="line"><span class="cl">            [rel]   =&gt; enclosure
</span></span><span class="line"><span class="cl">            [href]  =&gt; http://www.flickr.com/photos/20592809@N00/4422058708
</span></span><span class="line"><span class="cl">            [type]  =&gt; image/jpeg
</span></span><span class="line"><span class="cl">            [title] =&gt; The sock begins
</span></span><span class="line"><span class="cl">        )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>SimpleXMLElement Object
</span></span><span class="line"><span class="cl">(
</span></span><span class="line"><span class="cl">    [@attributes] =&gt; Array
</span></span><span class="line"><span class="cl">        (
</span></span><span class="line"><span class="cl">            [rel]  =&gt; replies
</span></span><span class="line"><span class="cl">            [type] =&gt; application/atom+xml
</span></span><span class="line"><span class="cl">            [href] =&gt; http://buzz.googleapis.com/feeds/108694322269563399860/comments/z13lhl3xavv4ujzga04cd1tqkrqpyjgrmtg0k
</span></span><span class="line"><span class="cl">        )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></span></span></code></pre>
</figure><p>This particular example has three links.</p>
<ul>
<li>An HTML &ldquo;alternate&rdquo; link that goes to the original Buzz post.</li>
<li>An image &ldquo;enclosure&rdquo; link that leads to the <a href="http://www.flickr.com/photos/20592809@N00/4422058708">Flickr
photo</a>.</li>
<li>An Atom &ldquo;replies&rdquo; link that leads to a feed of replies for the
original post.</li>
</ul>
<p>I care about the alternate and enclosure links, but not about the
replies. Now, every entry has an alternate link, but not all of them
have enclosure links. I will need to do a little processing to display
those links properly, but I don’t want that processing to occur down
there in the display section. I like to keep my displays as simple as
possible. I’m going to create a Buzz_Entry class to handle the hard
work.</p>
<p>The first stab at this class is going to be simple, just adding clearly
defined links for the Buzz and any enclosure.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Buzz/Entry.class.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Buzz_Entry</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$xml_node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">published</span> <span class="o">=</span> <span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">published</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">link</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enclosure</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span><span class="p">(</span><span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">link</span> <span class="k">as</span> <span class="nv">$link</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">switch</span><span class="p">(</span><span class="nv">$link</span><span class="p">[</span><span class="s1">&#39;rel&#39;</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;alternate&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">link</span> <span class="o">=</span> <span class="nv">$link</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;enclosure&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enclosure</span> <span class="o">=</span> <span class="nv">$link</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><p>The newest iteration of the main file builds a collection of Buzz_Entry
objects and takes advantage of the new attributes.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz/Entry.class.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">dump</span><span class="p">(</span><span class="nv">$variable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$output</span> <span class="o">=</span> <span class="nx">htmlentities</span><span class="p">(</span><span class="nx">print_r</span><span class="p">(</span><span class="nv">$variable</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;&lt;pre&gt;</span><span class="si">$output</span><span class="s2">&lt;/pre&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;buzz.xml&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$buzz</span> <span class="o">=</span> <span class="nx">simplexml_load_file</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$entries</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$buzz</span><span class="o">-&gt;</span><span class="na">entry</span> <span class="k">as</span> <span class="nv">$entry_node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$entry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buzz_Entry</span><span class="p">(</span><span class="nv">$entry_node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$entries</span><span class="p">,</span> <span class="nv">$entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Printing this, because PHP chokes on the &#39;&lt;?xml&#39; Processing Instruction
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">print</span> <span class="s1">&#39;&lt;?xml version=&#34;1.0&#34;?&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!DOCTYPE html
</span></span></span><span class="line"><span class="cl"><span class="err">    PUBLIC &#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34;
</span></span></span><span class="line"><span class="cl"><span class="err">    &#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; xml:lang=&#34;en&#34; lang=&#34;en&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;title&gt;Buzz Stream Test&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;h1&gt;Buzz Stream Test&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php foreach ($entries as $entry): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;?php echo $entry-&gt;content ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;p&gt;&lt;a href=&#34;&lt;?php echo $entry-&gt;link ?&gt;&#34;&gt;&lt;?php echo $entry-&gt;published ?&gt;&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;p&gt;&lt;?php echo $entry-&gt;title ?&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;?php if ($entry-&gt;enclosure): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;p&gt;&lt;a href=&#34;&lt;?php echo $entry-&gt;enclosure[&#39;href&#39;]?&gt;&#34;&gt;&lt;?php echo $entry-&gt;enclosure[&#39;title&#39;] ?&gt;&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;?php endif ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php endforeach ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/html&gt;
</span></span></span></code></pre>
</figure><p>Hey look! Now there’s stuff you can click!</p>
<p>I want to refactor a little bit now, and put that initial logic into a
separate file. It’s nice to keep your workplace tidy.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Buzz.inc.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz/Entry.class.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Prints the guts of a variable as preformatted text.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">dump</span><span class="p">(</span><span class="nv">$variable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$output</span> <span class="o">=</span> <span class="nx">htmlentities</span><span class="p">(</span><span class="nx">print_r</span><span class="p">(</span><span class="nv">$variable</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;&lt;pre&gt;</span><span class="si">$output</span><span class="s2">&lt;/pre&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Creates a collection of Buzz_Entry objects by
</span></span></span><span class="line"><span class="cl"><span class="sd"> * parsing the Buzz feed found in $source.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$buzz</span> <span class="o">=</span> <span class="nx">simplexml_load_file</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$entries</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$buzz</span><span class="o">-&gt;</span><span class="na">entry</span> <span class="k">as</span> <span class="nv">$entry_node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$entry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buzz_Entry</span><span class="p">(</span><span class="nv">$entry_node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">array_push</span><span class="p">(</span><span class="nv">$entries</span><span class="p">,</span> <span class="nv">$entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$entries</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><p>This makes the initial PHP block of the main file simple.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz.inc.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;buzz.xml&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$entries</span> <span class="o">=</span> <span class="nx">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Printing this, because PHP chokes on the &#39;&lt;?xml&#39; Processing Instruction
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">print</span> <span class="s1">&#39;&lt;?xml version=&#34;1.0&#34;?&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">⋮
</span></span></span></code></pre>
</figure><p>Now that I’ve satisfied my general sense of tidiness for the moment, I
want to make the &ldquo;published&rdquo; timestamp into something normal people can
read.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Buzz_Entry</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$xml_node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// For your own formatting options, see:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//   http://www.php.net/manual/en/function.date.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">published</span> <span class="o">=</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;g:i a, F jS&#39;</span><span class="p">,</span> <span class="nx">strtotime</span><span class="p">(</span><span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">published</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><p>It’s a good idea to set the time zone, especially if your &ldquo;published&rdquo;
format includes the time. I set mine in Buzz.inc.php.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Buzz.inc.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;America/Los_Angeles&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz/Entry.class.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre>
</figure><p>Now I don’t have to work so hard to figure out when a particular Buzz
was posted.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;example&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>The sock begins<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://www.google.com/buzz/108694322269563399860/PaTypwpxCkH/The-sock-begins&#34;</span><span class="p">&gt;</span>11:22 pm, March 9th<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Buzz by Brian Wisti from Flickr<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://www.flickr.com/photos/20592809@N00/4422058708&#34;</span><span class="p">&gt;</span>The sock begins<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></span></span></code></pre>
</figure><p>I want to make one more adjustment to the output. The phrase &ldquo;Buzz by
Brian Wisti from X&rdquo; in every title is redundant. &ldquo;X&rdquo; is the important
part. Let’s get rid of the title, and replace it with a source.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Buzz/Entry.class.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Buzz_Entry</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$xml_node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;Buzz by Brian Wisti from &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="nv">$xml_node</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span></code></pre>
</figure><p>I can’t forget to change the reference in the main PHP file.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$entries</span> <span class="k">as</span> <span class="nv">$entry</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;?php echo $entry-&gt;content ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;p&gt;&lt;a href=&#34;&lt;?php echo $entry-&gt;link ?&gt;&#34;&gt;&lt;?php echo $entry-&gt;published ?&gt;&lt;/a&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;p&gt;&lt;?php echo $entry-&gt;source ?&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">// ...
</span></span></span></code></pre>
</figure><p>Better?</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;example&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>The sock begins<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://www.google.com/buzz/108694322269563399860/PaTypwpxCkH/The-sock-begins&#34;</span><span class="p">&gt;</span>11:22 pm, March 9th<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Flickr<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://www.flickr.com/photos/20592809@N00/4422058708&#34;</span><span class="p">&gt;</span>The sock begins<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></span></span></code></pre>
</figure><p>Yes. Each entry now has what I consider a comfortable amount of
information. Sure, I would love to embed the image into the entry, but
that can wait. At least the link to the image is being displayed.</p>
<p>Besides, if I wait too long the Buzz API will cover all of this. I want
something up <em>today</em>.</p>
<p>Now that I have the information I want, it’s time to make the entries
pretty with a little shuffling and some CSS.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$entries</span> <span class="k">as</span> <span class="nv">$entry</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;div class=&#34;entry&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo $entry-&gt;content ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php if ($entry-&gt;enclosure): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;p class=&#34;enclosure&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;a href=&#34;&lt;?php echo $entry-&gt;enclosure[&#39;href&#39;]?&gt;&#34;&gt;&lt;?php echo $entry-&gt;enclosure[&#39;title&#39;] ?&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php endif ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;p class=&#34;published&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;a href=&#34;&lt;?php echo $entry-&gt;link ?&gt;&#34;&gt;&lt;?php echo $entry-&gt;published ?&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            (via &lt;?php echo $entry-&gt;source ?&gt;)
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php endforeach ?&gt;
</span></span></span></code></pre>
</figure><p>Here are the style rules that I used.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">.</span><span class="nc">entry</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">border</span><span class="p">:</span> <span class="kc">thin</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">padding</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">margin</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">entry</span> <span class="nt">a</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">text-decoration</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">entry</span> <span class="nt">p</span><span class="p">.</span><span class="nc">published</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">text-align</span><span class="p">:</span> <span class="kc">right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">font-size</span><span class="p">:</span> <span class="mi">75</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">entry</span> <span class="nt">p</span><span class="p">.</span><span class="nc">enclosure</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">em</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</figure><p>And the result may not be pretty, but it’s definitely better looking
than it was before.</p>
<h3 id="live-data">Live Data</h3>
<p>Most of my fiddling is done. It is time to use live data. On the home
machine, I only need to change the value of $source, because I have
<a href="http://us2.php.net/manual/en/filesystem.configuration.php#ini.allow-url-fopen">allow_url_fopen</a>
enabled.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz.inc.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Remember to replace &#39;brian.wisti&#39; with your username
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;http://buzz.googleapis.com/feeds/brian.wisti/public/posted&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$entries</span> <span class="o">=</span> <span class="nx">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...
</span></span></span></code></pre>
</figure><p>However, more is needed for this to work on the shared host.
allow_url_fopen is not available, but the <a href="http://us2.php.net/manual/en/ref.curl.php">PHP cURL
functions</a> are. Well, we work
with what we have.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Buzz.inc.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">ini_get</span><span class="p">(</span><span class="s1">&#39;allow_url_fopen&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;waffles&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$buzz</span> <span class="o">=</span> <span class="nx">simplexml_load_file</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">function_exists</span><span class="p">(</span><span class="s1">&#39;curl_init&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$curl</span> <span class="o">=</span> <span class="nx">curl_init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$raw_xml</span> <span class="o">=</span> <span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_close</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$buzz</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleXMLElement</span><span class="p">(</span><span class="nv">$raw_xml</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&#34;No reasonable fetching function available&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$entries</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$buzz</span><span class="o">-&gt;</span><span class="na">entry</span> <span class="k">as</span> <span class="nv">$entry_node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$entry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buzz_Entry</span><span class="p">(</span><span class="nv">$entry_node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">array_push</span><span class="p">(</span><span class="nv">$entries</span><span class="p">,</span> <span class="nv">$entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$entries</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</figure><p>Most of you can stop right here, but I need to do one more step. This
site is actually a bunch of static HTML content, with no server side
interaction. Well, almost static. I give myself permission to include
content feeds from supplemental files and sites via JavaScript.</p>
<p>It’s my site, and I go by my own strange rules. At least I try to be
consistent.</p>
<p>I’m going to do some quick and dirty
<a href="http://en.wikipedia.org/wiki/Ajax_%28programming%29">AJAX</a>. Very quick,
and very dirty. Let’s change the main buzz.php file so that it generates
an HTML fragment rather than a whole valid page.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz.inc.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;http://buzz.googleapis.com/feeds/brian.wisti/public/posted&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$entries</span> <span class="o">=</span> <span class="nx">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php foreach ($entries as $entry): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;div class=&#34;entry&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo $entry-&gt;content ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php if ($entry-&gt;enclosure): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;p class=&#34;enclosure&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;a href=&#34;&lt;?php echo $entry-&gt;enclosure[&#39;href&#39;]?&gt;&#34;&gt;&lt;?php echo $entry-&gt;enclosure[&#39;title&#39;] ?&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php endif ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;p class=&#34;published&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;a href=&#34;&lt;?php echo $entry-&gt;link ?&gt;&#34;&gt;&lt;?php echo $entry-&gt;published ?&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            (via &lt;?php echo $entry-&gt;source ?&gt;)
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php endforeach ?&gt;
</span></span></span></code></pre>
</figure><p>I will continue using <a href="http://jquery.com">jQuery</a> as the framework for
JavaScript interaction at this site, because it’s familiar to me.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;inc/js/jquery-1.4.2.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;inc/js/cnh.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre>
</figure><p>Off in my site JavaScript file cnh.js, I set up the buzz-loading
function. All it does is grab the output from buzz.php and insert it
into the document.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">get_buzz</span><span class="p">(</span><span class="nx">div</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span><span class="o">:</span> <span class="s2">&#34;/buzz/buzz.php&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cache</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">summary</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">div</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">summary</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</figure><p>Finally, I add the function call to my site index:</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;buzz&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="nx">get_buzz</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#my-buzz&#39;</span><span class="p">));</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">noscript</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>See my latest updates on <span class="p">&lt;</span><span class="nt">a</span>
</span></span><span class="line"><span class="cl"><span class="na">href</span><span class="o">=</span><span class="s">&#34;http://www.google.com/profiles/brian.wisti#buzz&#34;</span><span class="p">&gt;</span>Google Buzz<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">noscript</span><span class="p">&gt;</span></span></span></code></pre>
</figure><p>Hopefully you can now go to the <a href="/">home page</a> and see a Buzz feed!</p>
<blockquote>
<p><strong>NOTE</strong></p>
<p>Well, you could have if it was 2010 and Google Buzz was still a thing. Oh well.</p>
</blockquote>
<p>Okay, one issue. It’s showing the <em>whole</em> feed. Let’s throw in a limit
to the number of entries returned. I don’t feel like messing with the
calling code right now, so let’s have a reasonable default.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Buzz.inc.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">ini_get</span><span class="p">(</span><span class="s1">&#39;allow_url_fopen&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;waffles&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$buzz</span> <span class="o">=</span> <span class="nx">simplexml_load_file</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nx">function_exists</span><span class="p">(</span><span class="s1">&#39;curl_init&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$curl</span> <span class="o">=</span> <span class="nx">curl_init</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$curl</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$raw_xml</span> <span class="o">=</span> <span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">curl_close</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$buzz</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleXMLElement</span><span class="p">(</span><span class="nv">$raw_xml</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&#34;No reasonable fetching function available&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$entries</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$buzz</span><span class="o">-&gt;</span><span class="na">entry</span> <span class="k">as</span> <span class="nv">$entry_node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$limit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$entry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buzz_Entry</span><span class="p">(</span><span class="nv">$entry_node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">array_push</span><span class="p">(</span><span class="nv">$entries</span><span class="p">,</span> <span class="nv">$entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$limit</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$entries</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</figure><p>Okay. That’s a good enough hack for a low-traffic site like mine.</p>
<h3 id="cache-the-output">Cache the Output</h3>
<p>What would happen if I got twelve million hits per minute because the
world had suddenly become obsessed over whether I would ever finish
knitting those socks?</p>
<p>Well, my educated guess is that coolnamehere.com would be hosed. I have
a good host for the price, but I think that is more traffic than your
average shared host would be prepared for.</p>
<p>I can take precautions to reduce the load, though. One that comes to
mind is caching the HTML output to a file, and only checking for updates
every 30 minutes or so. That will involve using PHP’s <a href="http://www.php.net/manual/en/ref.outcontrol.php">output control
functions</a> to store the
output which would normally be printed.</p>
<p>I’m putting the display block into a template file, to make the
application flow a little easier to understand. The display block does
get an additional item to tell me <em>when</em> the cache was last built.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="cm">/* Buzz/Template.inc.php */</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;p class=&#34;generated&#34;&gt;Generated at &lt;?php echo $build_time ?&gt;&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php foreach ($entries as $entry): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;div class=&#34;entry&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php echo $entry-&gt;content ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php if ($entry-&gt;enclosure): ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;p class=&#34;enclosure&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;a href=&#34;&lt;?php echo $entry-&gt;enclosure[&#39;href&#39;]?&gt;&#34;&gt;&lt;?php echo $entry-&gt;enclosure[&#39;title&#39;] ?&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;?php endif ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;p class=&#34;published&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;a href=&#34;&lt;?php echo $entry-&gt;link ?&gt;&#34;&gt;&lt;?php echo $entry-&gt;published ?&gt;&lt;/a&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">            (via &lt;?php echo $entry-&gt;source ?&gt;)
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php endforeach ?&gt;
</span></span></span></code></pre>
</figure><p>The main <code>buzz.php</code> looks a bit different now. Instead of jumping
straight to the display, it looks for a cache file. If the cache file is
new enough -defined here as less than 30 minutes old - then the script
goes the easy way out and loads the cache. Otherwise, it buffers the
output into a string, which is then saved to the cache file.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz.inc.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;http://buzz.googleapis.com/feeds/brian.wisti/public/posted&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$html_cache</span> <span class="o">=</span> <span class="s2">&#34;/tmp/buzz.html&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$cache_limit</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// Maximum allowed age for cache, in seconds
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Load the cache if it exists and is new enough.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$cache_age</span> <span class="o">=</span> <span class="nx">time</span><span class="p">()</span> <span class="o">-</span> <span class="nx">filemtime</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$cache_age</span> <span class="o">&lt;</span> <span class="nv">$cache_limit</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$output</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Build the cache if it is not loaded.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$output</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$entries</span> <span class="o">=</span> <span class="nx">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$build_time</span> <span class="o">=</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;g:i a, F jS&#39;</span><span class="p">,</span> <span class="nx">time</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ob_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">require</span><span class="p">(</span><span class="s1">&#39;Buzz/Template.inc.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$output</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">,</span> <span class="nv">$output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><p>Oh right. Whatever the output was gets sent to the browser. Don’t want
to forget about that.</p>
<p>Sweet. It worked. I make a couple minor adjustments relevant to my
shared host settings, upload what I have, and hope for the best.</p>
<h3 id="a-quick-bug-fix">A Quick Bug Fix</h3>
<p>One issue is that the output gets displayed twice when the cache is
first built.</p>
<p>The problem is that I’m building <code>$output</code> by capturing standard output,
and then printing out <code>$output</code>. What I didn’t stop to think about is
the fact that standard output still gets displayed when the script is
done running.</p>
<p>Okay, so a quick fix is to only display output when it’s loaded from the
cache file.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;Buzz.inc.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$source</span> <span class="o">=</span> <span class="s1">&#39;http://buzz.googleapis.com/feeds/brian.wisti/public/posted&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$production_temp</span> <span class="o">=</span> <span class="s1">&#39;/home/bwisti/tmp&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$production_temp</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$html_cache</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">$production_temp</span><span class="s2">/buzz.html&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$html_cache</span> <span class="o">=</span> <span class="s2">&#34;/tmp/buzz.html&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$cache_limit</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// Maximum allowed age for cache, in seconds
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Load the cache if it exists and is new enough.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$cache_age</span> <span class="o">=</span> <span class="nx">time</span><span class="p">()</span> <span class="o">-</span> <span class="nx">filemtime</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$cache_age</span> <span class="o">&lt;</span> <span class="nv">$cache_limit</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$output</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Build the cache if it is not loaded.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$output</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$entries</span> <span class="o">=</span> <span class="nx">load_buzz</span><span class="p">(</span><span class="nv">$source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$build_time</span> <span class="o">=</span> <span class="nx">date</span><span class="p">(</span><span class="s1">&#39;g:i a, F jS&#39;</span><span class="p">,</span> <span class="nx">time</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ob_start</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">require</span><span class="p">(</span><span class="s1">&#39;Buzz/Template.inc.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$output</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$html_cache</span><span class="p">,</span> <span class="nv">$output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><h2 id="next-steps">Next Steps</h2>
<p>There is a lot more information in the XML that I haven’t used with my
naive application of SimpleXML. Once my eyes have uncrossed from this
quick burst of activity, I’ll want to figure out how to get at those
details and incorporate them into the feed.</p>
]]></content:encoded>
</item>
<item>
  <title>Post: PHPs extract and compact functions</title>
  <link>https://randomgeekery.org/post/2008/01/phps-extract-and-compact-functions/</link>
  <pubDate>Wed, 30 Jan 2008 00:00:00 -0800</pubDate>
  
  <guid>https://randomgeekery.org/post/2008/01/phps-extract-and-compact-functions/</guid>
  <description>&lt;p&gt;I’ve been brushing up on my &lt;a href=&#34;https://randomgeekery.org/card/php/&#34;&gt;PHP&lt;/a&gt; basics lately. Why? Well, it never hurts to revisit things you think you already know. There is a good chance you will discover something you didn’t know after all. For example: this time I learned about &lt;a href=&#34;http://php.net&#34;&gt;PHP&lt;/a&gt;’s &lt;code&gt;extract&lt;/code&gt; and &lt;code&gt;compact&lt;/code&gt; functions.&lt;/p&gt;</description>
   <category>post</category> 
   <category>post</category> 
   <category>php</category>  <category>blogspot</category> 
  <content:encoded><![CDATA[<p>I&rsquo;ve been brushing up on my <a href="/card/php/">PHP</a> basics lately. Why? Well, it never hurts to revisit things you think you already know. There is a good chance you will discover something you didn&rsquo;t know after all. For example: this time I learned about <a href="http://php.net">PHP</a>&rsquo;s <code>extract</code> and <code>compact</code> functions.</p>
<p><a href="http://us3.php.net/manual/en/function.extract.php"><code>extract</code></a> takes an associative array and creates local variables on the fly, named for the keys in the array and with the corresponding values matched up. <a href="http://us3.php.net/manual/en/function.compact.php"><code>compact</code></a> is the corresponding function for taking a collection of variables and stuffing them into an associative array.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$book</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;title&#34;</span>     <span class="o">=&gt;</span> <span class="s2">&#34;Dad&#39;s Own Cookbook&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;author&#34;</span>    <span class="o">=&gt;</span> <span class="s2">&#34;Bob Sloan&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">extract</span><span class="p">(</span><span class="nv">$book</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">echo</span> <span class="nv">$title</span> <span class="o">.</span> <span class="s2">&#34; was written by &#34;</span> <span class="o">.</span> <span class="nv">$author</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">$first</span> <span class="o">=</span> <span class="s2">&#34;Brian&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$last</span>  <span class="o">=</span> <span class="s2">&#34;Wisti&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$keys</span>  <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;first&#34;</span><span class="p">,</span> <span class="s2">&#34;last&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$my_name</span> <span class="o">=</span> <span class="nx">compact</span><span class="p">(</span><span class="nv">$keys</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">print_r</span><span class="p">(</span><span class="nv">$my_name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><p>Running this code:</p>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >$ php -f extract-compact.php
Dad&#39;s Own Cookbook was written by Bob Sloan
Array
(
    [first] =&gt; Brian
    [last] =&gt; Wisti
)</code></pre>
</figure><p><code>extract</code> is the more immediately useful of the two for my purposes, because it simplifies a common tactic I use for creating local variables based on database lookups.</p>
<p>Instead of manually creating local variables, like this:</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysql_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="nx">MYSQL_ASSOC</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$author</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&#34;author&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$title</span>  <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s2">&#34;title&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><p>I can save myself a little effort with <code>extract</code>.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysql_fetch_array</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="nx">MYSQL_ASSOC</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">extract</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre>
</figure><p>I realize that there may be an even easier way to do it, but just this will make my life noticeably easier as long as I don&rsquo;t abuse it. I would mainly tuck a call like this off in a function and probably use it in conjunction with a SQL query or something else where I knew exactly what names I would end up with.</p>
<p>Why didn&rsquo;t I know about this before? Well, the manual approach was good enough. And since what I had was good enough, I didn&rsquo;t think of looking for a better approach. Then again, finds like this are exactly why I <em>do</em> go back and review what I thought I already knew.</p>]]></content:encoded>
</item>
<item>
  <title>Post: I&#39;ve Been Experimenting With CakePHP</title>
  <link>https://randomgeekery.org/post/2006/09/ive-been-experimenting-with-cakephp/</link>
  <pubDate>Fri, 22 Sep 2006 00:00:00 -0700</pubDate>
  
  <guid>https://randomgeekery.org/post/2006/09/ive-been-experimenting-with-cakephp/</guid>
  <description>&lt;p&gt;I’ve been experimenting with &lt;a href=&#34;http://cakephp.org/&#34;&gt;CakePHP&lt;/a&gt; over the last couple of weeks for a project. It’s definitely not &lt;a href=&#34;http://rubyonrails.com/&#34;&gt;Ruby on Rails&lt;/a&gt;, but it has a lot of charm. This library provides a MVC system for &lt;a href=&#34;https://randomgeekery.org/card/php/&#34;&gt;PHP&lt;/a&gt; applications, but the really interesting thing is that you can just drop it onto your Web server space with no fuss or bother. You don’t even have to worry about clever mod_rewrite rules if you don’t want to.&lt;/p&gt;</description>
   <category>post</category> 
   <category>post</category> 
   <category>php</category>  <category>blogspot</category> 
  <content:encoded><![CDATA[<p>I&rsquo;ve been experimenting with <a href="http://cakephp.org/">CakePHP</a> over the last couple of weeks for a project. It&rsquo;s definitely not <a href="http://rubyonrails.com/">Ruby on Rails</a>, but it has a lot of charm. This library provides a MVC system for <a href="/card/php/">PHP</a> applications, but the really interesting thing is that you can just drop it onto your Web server space with no fuss or bother. You don&rsquo;t even have to worry about clever mod_rewrite rules if you don&rsquo;t want to.</p>
<p>Since CakePHP is so accessible, I thought it would be fun to explore the framework a little bit more, and document what&rsquo;s going on here. Now, I&rsquo;m not the greatest at remembering to update this blog, but I&rsquo;ll do my best.</p>
<p>My goal is straightforward: create a forum application, similar in purpose to <a href="http://www.phpbb.com/">phpBB</a>. I&rsquo;m sure it has already been done, but I&rsquo;m in this strictly for the educational exercise.</p>
<p>The first task - assuming you already have Web space with support for PHP and MySQL - is to get CakePHP. That&rsquo;s easy enough. Just grab the latest archive from the download section of the CakePHP site, and unpack it to your server space. I&rsquo;m fond of using my personal machine as a development site, so I won&rsquo;t be worrying about issues like uploading or editing remote files.</p>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >$ cd /var/www
$ sudo tar xfvz ~/cake_1.1.7.3363.tar.gz
...
$ mv cake_1.1.7.3363.tar.gz cakebb
$ sudo chown --recursive brianwisti cakebb</code></pre>
</figure><p>Okay, there are much safer approaches to setting things up, but I am only doing quick and dirty development on my home machine.</p>
<p>Next I need to manage the database connections. CakePHP uses PHP code for configuration, following along with the Rails idea of &ldquo;convention over configuration.&rdquo; The theory is that a handful of PHP files are easier to sort through than a handful of XML configuration files.</p>
<p>Configuration files are kept in <tt>cakebb/app/config</tt>. The first one I&rsquo;ll be looking at is database.php, except that there is no <tt>database.php</tt> when Cake is first extracted. We have a file <tt>database.php.default</tt> instead. I&rsquo;ll move it over to <tt>database.php</tt> so that Cake has something to look at on startup.</p>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >$ mv database.php.default database.php</code></pre>
</figure><p>Of course now I need to edit the file to establish the database connection details. I&rsquo;ll also need to set up the appropriate databases on my local MySQL server.</p>
<p>So here&rsquo;s the important part of <tt>database.php</tt>:</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DATABASE_CONFIG</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="nv">$default</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s1">&#39;connect&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mysql_connect&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cakebb&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cakebb_user&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my secret password&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">var</span> <span class="nv">$test</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;connect&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mysql_connect&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;login&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cakebb_user&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my secret password&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cakebb_test&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</figure><p>Then I go into the MySQL shell to create the databases and accounts needed by CakeBB.</p>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >$ mysql -uroot -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 6 to server version: 5.0.22-Debian_0ubuntu6.06.2-log
Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the buffer.

mysql&gt; create database cakebb;
Query OK, 1 row affected (0.01 sec)

mysql&gt; create database cakebb_test;
Query OK, 1 row affected (0.00 sec)

mysql&gt; grant all on cakebb.* to &#39;cakebb_user&#39;@&#39;%&#39; identified by &#39;my secret password&#39;;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; grant all on cakebb_test.* to &#39;cakebb_user&#39;@&#39;%&#39; identified by &#39;my secret password&#39;;
Query OK, 0 rows affected (0.00 sec)</code></pre>
</figure><p>I feel like skipping mod_rewrite for now, so I&rsquo;ll uncomment the following line (around line 40 of <tt>app/config/core.php</tt>):</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//  define (&#39;BASE_URL&#39;, env(&#39;SCRIPT_NAME&#39;));
</span></span></span></code></pre>
</figure><p>All I&rsquo;ve got at this point is the basic setup, but I should test it just to make sure everything is connecting. I send my browser to <code>http://localhost/cakebb/</code> and get a lovely status page telling me that CakePHP is installed and able to connect to the database.</p>
<p>Great. I&rsquo;m set up and functional. The next step will be to build the application models. But that will have to wait until tomorrow, because I need to get to work now.</p>]]></content:encoded>
</item>
</channel>
</rss>
