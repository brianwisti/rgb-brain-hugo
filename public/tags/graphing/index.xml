<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>graphingonRandom Geekery</title>
    <link>https://randomgeekery.org/tags/graphing/</link>
    <description>
      Recent contentingraphing on Random Geekery
    </description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
      
      <lastBuildDate>Mon, 16 Mar 2015 00:00:00 -0700</lastBuildDate><atom:link href="https://randomgeekery.org/tags/graphing/index.xml" rel="self" type="application/rss+xml" /><item>
  <title>Post: Ruby iTunes Ratings Fun</title>
  <link>https://randomgeekery.org/post/2015/03/ruby-itunes-ratings-fun/</link>
  <pubDate>Mon, 16 Mar 2015 00:00:00 -0700</pubDate>
  
  <guid>https://randomgeekery.org/post/2015/03/ruby-itunes-ratings-fun/</guid>
  <description>I use the plist and gruff gems to summarize my iTunes music ratings with Ruby
Introduction Earlier this year I did a fresh operating system install on my laptop. Part of that install involved moving all my music from an older machine. I moved the music, but not the iTunes details. My tastes changed over the years. Why not start with a fresh listen and fresh ratings for all?
A few months passed.</description>
   <category>post</category> 
   <category>post</category> 
   <category>ruby</category>  <category>itunes</category>  <category>graphing</category>  <category>music</category>  <category>programming</category> 
  <content:encoded><![CDATA[<h2>Using Ruby to summarize my iTunes music ratings</h2><p>I use the <a href="https://github.com/bleything/plist">plist</a> and <a href="https://github.com/topfunky/gruff">gruff</a> gems to summarize my iTunes music ratings with <a href="/card/ruby/">Ruby</a></p>
<h2 id="introduction">Introduction</h2>
<p>Earlier this year I did a fresh operating system install on my laptop. Part of that install involved moving all my music from an older machine. I moved the music, but not the iTunes details. My tastes changed over the years. Why not start with a fresh listen and fresh ratings for all?</p>
<p>A few months passed. How much progress have I made?</p>
<p>First off let me roll 1d100 and check the Random Language Chart. I rolled a 73, and that means I write this in Ruby.</p>
<p>I decided to look at the XML file that gets exported by iTunes whenever a library detail changes. <a href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man5/plist.5.html">Property List XML</a> frustrates quickly if you attack it with naive XML parsing. Fortunately, Ben Bleything wrote a <a href="https://github.com/bleything/plist">plist</a> gem that simplifies the task in Ruby.</p>
<p>Since I like pretty pictures, I may as well use Geoffrey Grosenbach’s <a href="https://github.com/topfunky/gruff">gruff</a> to make a pretty pie chart.</p>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >$ ruby --version
ruby 2.2.0p0 (2014-12-25 revision 49005) [x86_64-darwin14]
$ gem install plist
$ gem install gruff</code></pre>
</figure><h2 id="here-it-is">Here It Is</h2>
<p>No big code explanation this time around. My last few attempts at that have gone stale in my drafts folder. Plus, I’m worn out. I <em>tried</em> the naive XML parsing thing, and it frustrated me quickly. Thank goodness for <a href="https://github.com/bleything/plist">plist</a>.</p>
<p><strong><code>graph-ratings.rb</code></strong></p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;plist&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">require</span> <span class="s1">&#39;gruff&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">SOURCE</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/Music/iTunes/iTunes Music Library.xml&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plist</span> <span class="o">=</span> <span class="no">Plist</span><span class="o">.</span><span class="n">parse_xml</span> <span class="no">SOURCE</span>
</span></span><span class="line"><span class="cl"><span class="n">tracks</span> <span class="o">=</span> <span class="n">plist</span><span class="o">[</span><span class="s1">&#39;Tracks&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">songs</span> <span class="o">=</span> <span class="n">tracks</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reject</span> <span class="k">do</span> <span class="o">|</span><span class="n">track</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">  <span class="n">track</span><span class="o">[</span><span class="s1">&#39;Kind&#39;</span><span class="o">]</span> <span class="o">!~</span> <span class="sr">/audio file$/</span> <span class="o">||</span> <span class="n">track</span><span class="o">[</span><span class="s1">&#39;Genre&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;Podcast&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ratings</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Group the songs by rating.</span>
</span></span><span class="line"><span class="cl"><span class="n">songs</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">song</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">  <span class="n">rating</span> <span class="o">=</span> <span class="n">song</span><span class="o">[</span><span class="s1">&#39;Rating&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="n">total_time</span> <span class="o">=</span> <span class="n">song</span><span class="o">[</span><span class="s1">&#39;Total Time&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">ratings</span><span class="o">[</span><span class="n">rating</span><span class="o">]</span> <span class="o">||=</span> <span class="p">{</span> <span class="ss">songs</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">time</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">ratings</span><span class="o">[</span><span class="n">rating</span><span class="o">][</span><span class="ss">:songs</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="n">ratings</span><span class="o">[</span><span class="n">rating</span><span class="o">][</span><span class="ss">:time</span><span class="o">]</span> <span class="o">+=</span> <span class="n">total_time</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Print it.</span>
</span></span><span class="line"><span class="cl"><span class="nb">puts</span> <span class="s1">&#39;Rating Songs Percent Duration&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ratings</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">rating</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">  <span class="n">song_count</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">[</span><span class="n">rating</span><span class="o">][</span><span class="ss">:songs</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">total_seconds</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">[</span><span class="n">rating</span><span class="o">][</span><span class="ss">:time</span><span class="o">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">.</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="n">seconds</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
</span></span><span class="line"><span class="cl">  <span class="n">minutes</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_seconds</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span>
</span></span><span class="line"><span class="cl">  <span class="n">hours</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span> <span class="o">%</span> <span class="mi">24</span>
</span></span><span class="line"><span class="cl">  <span class="n">days</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">percentage</span> <span class="o">=</span> <span class="n">song_count</span><span class="o">.</span><span class="n">to_f</span><span class="p">()</span> <span class="o">/</span> <span class="n">songs</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">to_f</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="n">duration</span> <span class="o">=</span> <span class="nb">format</span> <span class="s1">&#39;%02d:%02d:%02d:%02d&#39;</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="nb">format</span> <span class="s1">&#39;%6d %5d %6.1f%% %s&#39;</span><span class="p">,</span> <span class="n">rating</span><span class="p">,</span> <span class="n">song_count</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">duration</span>
</span></span><span class="line"><span class="cl">  <span class="nb">puts</span> <span class="n">description</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Graph it.</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">rating</span><span class="p">,</span> <span class="n">info</span><span class="o">|</span> <span class="o">[</span> <span class="n">rating</span><span class="p">,</span> <span class="o">[</span> <span class="n">info</span><span class="o">[</span><span class="ss">:songs</span><span class="o">]]]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">graph</span> <span class="o">=</span> <span class="no">Gruff</span><span class="o">::</span><span class="no">Pie</span><span class="o">.</span><span class="n">new</span>
</span></span><span class="line"><span class="cl"><span class="n">graph</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&#34;Songs Grouped By Rating&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ratings</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">rating</span><span class="o">|</span> <span class="n">graph</span><span class="o">.</span><span class="n">data</span> <span class="n">rating</span><span class="p">,</span> <span class="n">ratings</span><span class="o">[</span><span class="n">rating</span><span class="o">][</span><span class="ss">:songs</span><span class="o">]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">graph</span><span class="o">.</span><span class="n">write</span> <span class="s2">&#34;song-pie.png&#34;</span></span></span></code></pre>
</figure><p>Running it shows me that I have more than a month of music to rate, and only if I can rate music in my sleep.</p>
<figure class="highlight">
  <pre tabindex="0"
    ><code class="language-" data-lang=""
      >Rating Songs Percent Duration
     0 13907   83.0% 38:05:56:14
    20    60    0.4% 00:03:41:48
    40   179    1.1% 00:12:28:46
    60  1351    8.1% 03:16:21:32
    80   984    5.9% 02:14:57:47
   100   273    1.6% 00:17:44:35</code></pre>
</figure><p>It seems I still like most of the music I own at least a little bit. Many former favorites have drifted to the 60 rating (3 stars), though. Time does change tastes a little bit.</p>
<p>The graph. Let’s look at that pretty picture.</p>
<p><img src="/post/2015/03/attachments/img/2015/song-pie.png" alt="Ratings pie chart"/></p>
<p>Yes. I have much music listening ahead of me.</p>
]]></content:encoded>
</item>
</channel>
</rss>
