<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.60856f0f2ed73fb3cd2820ee548c4698ffbc4d743736e852c0e27ce4f52dfd9c.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  

<meta property="og:url" content="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/">
<meta property="og:title" content="Querying Hugo Content With Python">
<meta name="twitter:title" content="Querying Hugo Content With Python">


  <meta name="twitter:site" content="@brianwisti">



  
    <meta name="twitter:description" content="I had entirely too much fun replacing my site metadata script with sqlite-utils
">
    <meta property="og:description" content="I had entirely too much fun replacing my site metadata script with sqlite-utils
">
  



<title itemprop="name">Querying Hugo Content With Python - Random Geekery</title>
<meta property="og:title" content=Querying&#32;Hugo&#32;Content&#32;With&#32;Python&#32;-&#32;Random&#32;Geekery />
<meta name="twitter:title" content=Querying&#32;Hugo&#32;Content&#32;With&#32;Python&#32;-&#32;Random&#32;Geekery />
<meta itemprop="name" content=Querying&#32;Hugo&#32;Content&#32;With&#32;Python&#32;-&#32;Random&#32;Geekery />
<meta name="application-name" content=Querying&#32;Hugo&#32;Content&#32;With&#32;Python&#32;-&#32;Random&#32;Geekery />
<meta property="og:site_name" content="Random Geekery" />


<meta name="description" content="I had entirely too much fun replacing my site metadata script with sqlite-utils
" />
<meta itemprop="description" content="I had entirely too much fun replacing my site metadata script with sqlite-utils
" />
<meta property="og:description" content="I had entirely too much fun replacing my site metadata script with sqlite-utils
" />
<meta name="twitter:description" content="I had entirely too much fun replacing my site metadata script with sqlite-utils
" />


<base href="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/" />
<link rel="canonical" href="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/" itemprop="url" />
<meta name="url" content="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/" />
<meta name="twitter:url" content="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/" />
<meta property="og:url" content="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/" />


<meta property="og:updated_time" content=6005-06-11T537:00:20-0700 />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://randomgeekery.org/sitemap.xml' />

  <link
      rel="alternate"
      type="application/rss+xml"
    
        href="/index.xml"
    
      title="Random Geekery"/>



<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Random Geekery" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.121.2">


    
    

<link
    rel="stylesheet"
    href="/css/style.fe9735814e6394fb590ff4fd2eb036a13152e6808ad90dd06ba181d89087b5d3.css"
    integrity="sha256-/pc1gU5jlPtZD/T9LrA2oTFS5oCK2Q3Qa6GB2JCHtdM=" 
    crossorigin="anonymous">


</head>

    <body class="">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://randomgeekery.org">
                <h1>Random Geekery</h1>
            </a>
        
    </h1>
    <p class="lead">
    Collecting my attempts to improve at tech, art, and life
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">
      
        <li class="bullet">
          <a href="/follow/">Follow</a>
        </li>
      
        <li class="bullet">
          <a href="/now/">Now</a>
        </li>
      
    </ul>
</nav>

        
  <div class="related">
    <div class="related-posts">
      <h3>Related</h3>
      <ul>
        
          <li><a href="/post/2020/04/h-entry-microformat-for-indieweb-posts/">h-entry Microformat for Indieweb Posts</a></li>
        
          <li><a href="/post/2020/02/python-invoke/">Python Invoke</a></li>
        
          <li><a href="/post/2021/08/trying-a-thing-with-neovim/">trying a thing with neovim</a></li>
        
          <li><a href="/post/2020/11/using-the-webmentionio-api/">Using the Webmention.io API</a></li>
        
          <li><a href="/post/2020/06/csv-and-data-tables-in-hugo/">CSV and Data Tables in Hugo</a></li>
        
      </ul>
    </div>
  </div>



        
















        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Brian Wisti. All rights reserved.
</p>
<p class="footnote">
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
  </a>.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <nav class="masthead">
    <ul>
    
  
    
  
    
  
    
  

    <li><a href="https://randomgeekery.org/">Random Geekery</a></li>
  

    <li><a href="https://randomgeekery.org/post/">Posts</a></li>
  

    <li><a href="https://randomgeekery.org/post/2020/">2020</a></li>
  

    <li><a class="active" href="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/">Querying Hugo Content With Python</a></li>
</nav>



  <div class="info">
    <h1 class="post-title">
        <a href="https://randomgeekery.org/post/2020/05/querying-hugo-content-with-python/">Querying Hugo Content With Python</a>
    </h1>
    
        <time datetime="2020-05-06T23:37:00-0700" class="post-date">
            May 6, 2020
        </time>
    
    
    <ul class="tags">
        
        <li class="tag-hugo">
            <a href="https://randomgeekery.org/tags/hugo">hugo</a>
        </li>
        
        <li class="tag-python">
            <a href="https://randomgeekery.org/tags/python">python</a>
        </li>
        
        <li class="tag-site">
            <a href="https://randomgeekery.org/tags/site">site</a>
        </li>
        
        <li class="tag-data">
            <a href="https://randomgeekery.org/tags/data">data</a>
        </li>
        
        <li class="tag-workflow">
            <a href="https://randomgeekery.org/tags/workflow">workflow</a>
        </li>
        
        <li class="tag-tools">
            <a href="https://randomgeekery.org/tags/tools">tools</a>
        </li>
        
    </ul>
    
    
    
    
    
    
</div>

  <p><img src="/post/2020/05/../../../attachments/img/2020/cover-2020-05-06.png" alt="attachments/img/2020/cover-2020-05-06.png"/>
My blogging output by year – bet you didn’t know there were blogs in 1 CE</p>
<h2 id="the-plan">The plan</h2>
<p>Use Simon Williamson’s <a href="https://datasette.readthedocs.io/en/stable/ecosystem.html#ecosystem">Datasette tools</a> — and maybe the rest of and maybe the rest of <a href="https://datasette.readthedocs.io/en/stable/">Datasette</a> too — to replace an existing data script and perhaps gain new insight into site contents.</p>
<p>Also: puttering is fun.</p>
<h2 id="background">Background</h2>
<p>I incorporated in my site workflow a while back because of <a href="https://blog.afoolishmanifesto.com/">fRew Schmidt</a>.  See, he wrote an interesting post about his Hugo / Unix / Vim <a href="https://blog.afoolishmanifesto.com/posts/hugo-unix-vim-integration/">blogging workflow</a>. I immediately copied <a href="https://blog.afoolishmanifesto.com/posts/hugo-unix-vim-integration/#advanced-unix-tools"><code>q</code></a>, a <a href="/card/perl/">card/Perl</a> script he wrote for querying site metadata via an in-memory <a href="https://sqlite.org">SQLite</a> database.</p>
<p><code>q</code> is ridiculously fast and convenient if you know the query you want to ask.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> q --sql <span class="s1">&#39;select count(1) from articles where title like &#34;%perl%&#34;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="go">22
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span> q --sql <span class="s1">&#39;select count(1) from articles where title like &#34;%python%&#34;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="go">25
</span></span></span></code></pre>
</figure><p>Is your query too awkward to comfortably type on a command line? Put it in a shell script, like fREW’s <code>tag-count</code> example.</p>
<figure class="highlight">
  <figcaption><tt>tag-count</tt></figcaption>
  <pre tabindex="0" class="chroma"
    ><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> scripts/q <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --sql <span class="s1">&#39;SELECT COUNT(*) AS c, tag FROM _ GROUP BY tag ORDER BY COUNT(*), tag&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --formatter <span class="s1">&#39;sprintf &#34;%3d %s&#34;, $r{c}, $r{tag}&#39;</span></span></span></code></pre>
</figure><p>That gets you a list of all the tags in your entries, ordered by number of appearances.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> tag-count
</span></span><span class="line"><span class="cl"><span class="go">⋮
</span></span></span><span class="line"><span class="cl"><span class="go"> 29 ruby
</span></span></span><span class="line"><span class="cl"><span class="go"> 33 perl
</span></span></span><span class="line"><span class="cl"><span class="go"> 38 python
</span></span></span><span class="line"><span class="cl"><span class="go"> 43 learn
</span></span></span><span class="line"><span class="cl"><span class="go"> 45 drawing
</span></span></span><span class="line"><span class="cl"><span class="go"> 77 site
</span></span></span></code></pre>
</figure><p>I converted it to <a href="/card/python/">card/Python</a> eventually, of course. <a href="https://github.com/kennethreitz-archive/records">Records</a> produced nice-looking output while letting me stick to SQL syntax. Noticeably slower than <code>q</code>, but acceptable. A bit later, I added a table for aliases. Then, another table for announcements — my tweets and toots about new content.</p>
<p>Aside from answering idle questions like &ldquo;how many drawings have I posted?&rdquo; my little database streamlines the process of publishing site updates and automatically announcing new posts.</p>
<h2 id="whats-the-problem">What’s the problem?</h2>
<p>I’m thinking about adding more tables to improve <a href="/card/indieweb/">card/IndieWeb</a> integration. But to be honest, my creation has grown unwieldy. And <em>slow</em>.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> <span class="nb">time</span> query <span class="s1">&#39;select date, title from articles order by date&#39;</span>
</span></span><span class="line"><span class="cl"><span class="go">⋮
</span></span></span><span class="line"><span class="cl"><span class="go">Skinny Lines and Flat Colors                             |2020-05-02T21:11:00-07:00
</span></span></span><span class="line"><span class="cl"><span class="go">Pondering My Indieweb Guinea Pig                         |2020-05-03T20:30:00-07:00
</span></span></span><span class="line"><span class="cl"><span class="go">Got a Working glitch-soc Rails Dev Environment           |2020-05-04T23:26:21-07:00
</span></span></span><span class="line"><span class="cl"><span class="go">445 rows
</span></span></span><span class="line"><span class="cl"><span class="go">query &#39;select title, published_at from contents order by published_at&#39;  \
</span></span></span><span class="line"><span class="cl"><span class="go">2.64s user 0.13s system 101% cpu 2.730 total
</span></span></span></code></pre>
</figure><p>Compared to the original Perl script?</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> <span class="nb">time</span> q --sql <span class="s1">&#39;select date, title from articles where date is not null is not null order by date&#39;</span>
</span></span><span class="line"><span class="cl"><span class="go">⋮
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-02T21:11:00-07:00    Skinny Lines and Flat Colors
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-03T15:46:00-07:00    Sending Webmentions
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-03T20:30:00-07:00    Pondering My Indieweb Guinea Pig
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-04 23:26:21-07:00    Got a Working glitch-soc Rails Dev Environment
</span></span></span><span class="line"><span class="cl"><span class="go">q --sql   0.17s user 0.02s system 99% cpu 0.197 total
</span></span></span></code></pre>
</figure><p>I’m tempted to gut my Python workflow. Start fresh from <code>q</code> and Perl again. But no. That would be a lot of work — duplicated work, at that.</p>
<p>I’ll stick to Python for now. But surely we can do better than the duct tape script I’ve been using.</p>
<p><a href="https://simonwillison.net/">Simon Willison</a>&rsquo;s <code>sqlite-utils</code> may be just the thing.</p>
<h2 id="whats-sqlite-utils">What’s <code>sqlite-utils</code>?</h2>
<p><a href="https://sqlite-utils.readthedocs.io/"><code>sqlite-utils</code></a> provides both a Python library and a command
line too for building and querying SQLite databases. It can guess a schema from
structures as you insert them — though you can be explicit if you prefer. It’s
particularly useful for bulk inserting or exporting data dumps in JSON or <a href="/card/csv/">CSV</a>.</p>
<p>Makes sense. It’s part of the <a href="https://datasette.readthedocs.io/en/stable/ecosystem.html#ecosystem">Datasette ecosystem</a>.  Willison’s Datasette project simplifies exploring and publishing data for folks who understand data but not necessarily databases.</p>
<p>And although it’s slower than <code>q</code> for SQL queries, it’s much closer than what I came up with!</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> <span class="nb">time</span> sqlite-utils site.db <span class="s1">&#39;select publishDate, title from entries order by publishDate&#39;</span> --table
</span></span><span class="line"><span class="cl"><span class="go">⋮
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-03T04:11:00+00:00  Skinny Lines and Flat Colors
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-03T22:46:00+00:00  Sending Webmentions
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-04T03:30:00+00:00  Pondering My Indieweb Guinea Pig
</span></span></span><span class="line"><span class="cl"><span class="go">2020-05-05T06:26:21+00:00  Got a Working glitch-soc Rails Dev Environment
</span></span></span><span class="line"><span class="cl"><span class="go">sqlite-utils site.db  --table  0.54s user 0.16s system 158% cpu 0.442 total
</span></span></span></code></pre>
</figure><h2 id="creating-sitedb-with-sqlite-utils">Creating <code>site.db</code> with <code>sqlite-utils</code></h2>
<p>Okay! Let’s do this. I want to load and prepare details from my content entries before I let <code>sqlite-utils</code> turn it into a database.</p>
<h3 id="getting-metadata-from-hugo-and-front-matter">Getting metadata from Hugo and front matter</h3>
<p>We could recursively walk through the <code>content/</code> folder, collecting front matter details about everything we find. Most of the time, this is more than I want. <a href="https://gohugo.io/content-management/organization/">Hugo site organization</a> includes supplemental material like page bundles and <code>_index</code> pages. That’s distracting when I only want to focus on my posts and notes. If you just want core content — posts, pages, stuff like that — ask Hugo.</p>
<p>I <a href="/post/2020/03/listing-hugo-content-extensions-with-raku/">mentioned</a> the <code>hugo list</code> commands before. <a href="https://gohugo.io/commands/hugo_list_all/"><code>hugo list all</code></a> prints summaries of all your main content entries, as comma-separated text. Python’s standard <a href="https://docs.python.org/3/library/subprocess.html">subprocess</a> and <a href="https://docs.python.org/3/library/csv.html">csv</a> are all I need to turn that into something useful.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">list_hugo_content</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Return a listing of hugo content entries&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s2">&#34;hugo&#34;</span><span class="p">,</span> <span class="s2">&#34;list&#34;</span><span class="p">,</span> <span class="s2">&#34;all&#34;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="o">.</span><span class="n">stdout</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">))</span></span></span></code></pre>
</figure><p><a href="https://docs.python.org/3/library/csv.html#csv.DictReader">csv.DictReader</a> gives me a collection of manageable dictionaries.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-04-28T01:36:54-07:00&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;draft&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;expiryDate&#39;</span><span class="p">:</span> <span class="s1">&#39;0001-01-01T00:00:00Z&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;content/post/2020/04/from-dotfiles-to-org-file/index.adoc&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;permalink&#39;</span><span class="p">:</span> <span class="s1">&#39;https://randomgeekery.org/post/2020/04/from-dotfiles-to-org-file/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;publishDate&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-04-28T01:36:54-07:00&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;slug&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;From Dotfiles to Org File&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</figure><p>That’s useful for a high level overview of <a href="/post/2020/04/from-dotfiles-to-org-file/">that post</a>, but I want more. I want tags, categories, aliases, etc. I keep those details as <a href="https://yaml.org/">YAML</a> text in content <a href="https://gohugo.io/content-management/front-matter/">front matter</a>.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">From Dotfiles to Org File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">uuid</span><span class="p">:</span><span class="w"> </span><span class="l">f03e5f2f-70a8-4988-92cd-595c8e3fdc97</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">at 1:30am they&#39;re all good ideas</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">year</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2020&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">date</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2020-04-28 01:36:54-07:00&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">emacs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">shell</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">org</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">draft</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">categories</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">Tools</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">aliases</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">/2020/04/28/from-dotfiles-to-org-file/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">announcements</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mastodon</span><span class="p">:</span><span class="w"> </span><span class="l">https://hackers.town/@randomgeek/104075340897518607</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">twitter</span><span class="p">:</span><span class="w"> </span><span class="l">https://twitter.com/brianwisti/status/1255056188087111681</span></span></span></code></pre>
</figure><p><a href="https://pyyaml.org">PyYAML</a> moves quick when powered by <a href="https://pyyaml.org/wiki/LibYAML">libYAML</a>.  So I make sure I have both installed on my Manjaro machine.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> pamac install libyaml
</span></span><span class="line"><span class="cl"><span class="gp">$</span> pip install pyyaml
</span></span></code></pre>
</figure><p>I can’t think of a pretty way to get at an entry’s front matter, so let’s just get it out of the way.</p>
<blockquote>
<p><strong>NOTE</strong></p>
<p>It’s not worth rewriting a whole blog post just yet, but in the years since writing this I use <a href="https://github.com/eyeseast/python-frontmatter">python-frontmatter</a> to handle frontmatter.</p>
</blockquote>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">yaml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DELIMITER</span> <span class="o">=</span> <span class="s2">&#34;---</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_frontmatter</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Get dictionary from a file&#39;s YAML frontmatter&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">_</span><span class="p">,</span> <span class="n">yaml_text</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">DELIMITER</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_text</span><span class="p">)</span></span></span></code></pre>
</figure><ol>
<li>read the file</li>
<li>grab the front matter YAML</li>
<li>hand back a dictionary based on that front matter text</li>
</ol>
<p>Why a function? It’s only a couple lines of code.</p>
<p>Sure, but it’s an ugly couple of lines. Plus it hides the YAML-specific details away in case I switch my front matter to TOML, JSON, or some other format.</p>
<p>Okay, now to mash entry and relevant front matter bits together. I prefer <a href="https://arrow.readthedocs.io/">Arrow</a> &rsquo;s interface to <a href="https://docs.python.org/3.8/library/datetime.html">datetime</a>.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> pip install arrow
</span></span></code></pre>
</figure><figure class="highlight">
  <figcaption><span>Import entry dependencies</span></figcaption>
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">arrow</span></span></span></code></pre>
</figure><figure class="highlight">
  <figcaption><span>Prepare entry</span></figcaption>
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">SiteEntry</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&#34;SiteEntry&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;entry&#34;</span><span class="p">,</span> <span class="s2">&#34;tags&#34;</span><span class="p">,</span> <span class="s2">&#34;announcements&#34;</span><span class="p">,</span> <span class="s2">&#34;aliases&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prepare_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Return a SiteEntry with details about a single content entry&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">frontmatter</span> <span class="o">=</span> <span class="n">get_frontmatter</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">entry</span><span class="p">[</span><span class="s2">&#34;draft&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;draft&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;true&#34;</span> <span class="k">else</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Convert date strings to native datetime objects.</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&#34;date&#34;</span><span class="p">,</span> <span class="s2">&#34;expiryDate&#34;</span><span class="p">,</span> <span class="s2">&#34;publishDate&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">entry</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="n">f</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&#34;utc&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sections</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&#34;note&#34;</span><span class="p">,</span> <span class="s2">&#34;post&#34;</span><span class="p">,</span> <span class="s2">&#34;draft&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">section_fragment</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">entry</span><span class="p">[</span><span class="s2">&#34;section&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">section_fragment</span> <span class="k">if</span> <span class="n">section_fragment</span> <span class="ow">in</span> <span class="n">sections</span> <span class="k">else</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Extract important fields from frontmatter</span>
</span></span><span class="line"><span class="cl">    <span class="n">simple_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&#34;caption&#34;</span><span class="p">,</span> <span class="s2">&#34;category&#34;</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">,</span> <span class="s2">&#34;series&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">simple_fields</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">entry</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">frontmatter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">tags</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&#34;entry_path&#34;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&#34;tag&#34;</span><span class="p">:</span> <span class="n">tag</span><span class="p">}</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">frontmatter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;tags&#34;</span><span class="p">,</span> <span class="p">[])]</span>
</span></span><span class="line"><span class="cl">    <span class="n">announcements</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;entry_path&#34;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&#34;service&#34;</span><span class="p">:</span> <span class="n">service</span><span class="p">,</span> <span class="s2">&#34;url&#34;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">service</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">frontmatter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;announcements&#34;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;entry_path&#34;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&#34;url&#34;</span><span class="p">:</span> <span class="n">alias</span><span class="p">}</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">frontmatter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;aliases&#34;</span><span class="p">,</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">SiteEntry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">announcements</span><span class="p">,</span> <span class="n">aliases</span><span class="p">)</span></span></span></code></pre>
</figure><ul>
<li>A <a href="https://docs.python.org/3/library/collections.html#collections.namedtuple">namedtuple</a> helps when you want some structure but not a full class.</li>
<li>Always make sure times are in <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC</a> when saving to the database!</li>
<li>Hugo determines <a href="https://gohugo.io/content-management/sections/">sections</a> from a file’s location under <code>content/</code>, so let’s do the same.</li>
<li><code>entry_path</code> will help connect tags to entries when creating the database</li>
</ul>
<p>I got everything tidy and pretty. We’re ready for the database.</p>
<h3 id="loading-the-data">Loading the data</h3>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> pip install sqlite-utils
</span></span></code></pre>
</figure><p>The <code>sqlite-utils</code> <a href="https://sqlite-utils.readthedocs.io/en/stable/python-api.html">Python API</a> ends up taking hardly any code at all, thanks partly to the work spent massaging the entries. You treat the database as a dictionary, with each table name as a field. Tables get created when you insert something.</p>
<p>I think we called that &ldquo;autovivification&rdquo; in Perl. It’s nice.</p>
<figure class="highlight">
  <figcaption><span>import sqlite-utils</span></figcaption>
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlite_utils</span> <span class="kn">import</span> <span class="n">Database</span></span></span></code></pre>
</figure><figure class="highlight">
  <figcaption><span>build databse</span></figcaption>
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DB_NAME</span> <span class="o">=</span>  <span class="s2">&#34;site.db&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">build_db</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Build the database&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">announcements</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">list_hugo_content</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">site_entry</span> <span class="o">=</span> <span class="n">prepare_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site_entry</span><span class="o">.</span><span class="n">entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">tags</span> <span class="o">+=</span> <span class="n">site_entry</span><span class="o">.</span><span class="n">tags</span>
</span></span><span class="line"><span class="cl">        <span class="n">announcements</span> <span class="o">+=</span> <span class="n">site_entry</span><span class="o">.</span><span class="n">announcements</span>
</span></span><span class="line"><span class="cl">        <span class="n">aliases</span> <span class="o">+=</span> <span class="n">site_entry</span><span class="o">.</span><span class="n">aliases</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">site</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">site</span><span class="p">[</span><span class="s2">&#34;entries&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">insert_all</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="s2">&#34;path&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">site</span><span class="p">[</span><span class="s2">&#34;tags&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">insert_all</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">tags</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;entry_path&#34;</span><span class="p">,</span> <span class="s2">&#34;tag&#34;</span><span class="p">),</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[(</span><span class="s2">&#34;entry_path&#34;</span><span class="p">,</span> <span class="s2">&#34;entries&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">site</span><span class="p">[</span><span class="s2">&#34;announcements&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">insert_all</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">announcements</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">pk</span><span class="o">=</span><span class="p">(</span><span class="s2">&#34;entry_path&#34;</span><span class="p">,</span> <span class="s2">&#34;url&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[(</span><span class="s2">&#34;entry_path&#34;</span><span class="p">,</span> <span class="s2">&#34;entries&#34;</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">site</span><span class="p">[</span><span class="s2">&#34;aliases&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">insert_all</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">aliases</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="s2">&#34;url&#34;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[(</span><span class="s2">&#34;entry_path&#34;</span><span class="p">,</span> <span class="s2">&#34;entries&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span></span></span></code></pre>
</figure><ul>
<li>Rebuild the database from scratch every time this runs. Alternately, leave this out and <code>upsert_all</code> to do an insert or update.</li>
<li>Setting <code>path</code> as the primary key, since every filename should be unique.</li>
<li>A tuple <code>pk</code> specifies a compound primary key — each pair must be unique.</li>
<li><code>sqlite-utils</code> hides the details of foreign keys in SQLite. Just use a list of <code>FIELD_NAME</code> / <code>TABLE_NAME</code> pairs.</li>
</ul>
<p>All that works makes <code>build_db</code> a convenient starting point for <code>build-db.py</code>.</p>
<figure class="highlight">
  <figcaption><span>define script execution</span></figcaption>
  <pre tabindex="0" class="chroma"
    ><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">build_db</span><span class="p">()</span></span></span></code></pre>
</figure><p>I <em>could</em> specify an in-memory database, but no. For the moment I’ll settle on creating a database file. That way I can more easily play with the <code>sqlite-utils</code> command line interface.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> sqlite-utils tables site.db --counts --json-cols <span class="p">|</span> python -m json.tool
</span></span><span class="line"><span class="cl"><span class="go">[
</span></span></span><span class="line"><span class="cl"><span class="go">    {
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;table&#34;: &#34;entries&#34;,
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;count&#34;: 467
</span></span></span><span class="line"><span class="cl"><span class="go">    },
</span></span></span><span class="line"><span class="cl"><span class="go">    {
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;table&#34;: &#34;tags&#34;,
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;count&#34;: 1043
</span></span></span><span class="line"><span class="cl"><span class="go">    },
</span></span></span><span class="line"><span class="cl"><span class="go">    {
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;table&#34;: &#34;announcements&#34;,
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;count&#34;: 299
</span></span></span><span class="line"><span class="cl"><span class="go">    },
</span></span></span><span class="line"><span class="cl"><span class="go">    {
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;table&#34;: &#34;aliases&#34;,
</span></span></span><span class="line"><span class="cl"><span class="go">        &#34;count&#34;: 900
</span></span></span><span class="line"><span class="cl"><span class="go">    }
</span></span></span><span class="line"><span class="cl"><span class="go">]
</span></span></span></code></pre>
</figure><p>I’m content. But I’m also curious. What does my site metadata look like in Datasette?</p>
<h2 id="exploring-sitedb-with-datasette">Exploring <code>site.db</code> with Datasette</h2>
<p>I don’t have any great insights here. I just wanted to look at the pretty
tables. Played with <a href="https://datasette.readthedocs.io/en/stable/metadata.html">metadata</a> and checked out the results.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> pip install datasette
</span></span><span class="line"><span class="cl"><span class="go">⋮
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span> datasette serve --metadata datasette.json site.db
</span></span></code></pre>
</figure><p>The basic interface is pleasant enough, especially when you apply some <a href="https://developer.mozilla.org/en-US/docs/Web/CSS">CSS</a> Of course, <a href="https://www.niche-museums.com/">Niche Museums</a> shows you can go a <em>long</em> ways past &ldquo;some CSS&rdquo; with Datasette.</p>
<p>Oh and more on the pleasant interface. It allows you to edit the SQL for your current view.</p>
<p><img src="/post/2020/05/attachments/img/2020/datasette-sql.png" alt="lightly styled with custom SQL"/></p>
<p>There are detail pages for each row. Again, the Niche Museums site shows that <a href="https://www.niche-museums.com/browse/museums/21">detail view</a> can be heavily tweaked.</p>
<p><img src="/post/2020/05/attachments/img/2020/datasette-entry.png" alt="Datasette detail view of a post"/></p>
<p><a href="https://datasette.readthedocs.io/en/stable/ecosystem.html#datasette-plugins">Plugins</a> add all sorts of functionality. <a href="https://github.com/simonw/datasette-vega">datasette-vega</a> draws graphs of query results.</p>
<p><img src="/post/2020/05/attachments/img/2020/datasette-graph.png" alt="Charting interface with entries posted per year"/></p>
<p>Year 0001? Hang on, let me check that in my shiny new Datasette server.</p>
<figure class="highlight">
  <pre tabindex="0" class="chroma"
    ><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">path</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">title</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">publishDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">draft</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">section</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">entries</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s2">&#34;publishDate&#34;</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;0001%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">publishDate</span><span class="w"> </span><span class="k">desc</span></span></span></code></pre>
</figure><h3 id="year-0001-content">Year 0001 content</h3>
<table>
<thead>
<tr>
<th>path</th>
<th>title</th>
<th>publishDate</th>
<th>draft</th>
<th>section</th>
<th>category</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>content/about/index.adoc</code></td>
<td>About</td>
<td>0001-01-01T00:00:00+00:00</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>content/contact.adoc</code></td>
<td>Contact</td>
<td>0001-01-01T00:00:00+00:00</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>content/follow.adoc</code></td>
<td>Follow</td>
<td>0001-01-01T00:00:00+00:00</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>content/error.adoc</code></td>
<td>uh oh</td>
<td>0001-01-01T00:00:00+00:00</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>content/now/index.adoc</code></td>
<td>Now</td>
<td>0001-01-01T00:00:00+00:00</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>…and a bunch of drafts</td>
<td><em>[redacted]</em></td>
<td>0001-01-01T00:00:00+00:00</td>
<td>1</td>
<td>draft</td>
<td><em>[redacted]</em></td>
</tr>
</tbody>
</table>
<p>Oh that’s right. Non-dated pages and drafts.</p>
<p>No I’m too embarrassed to share the full list. I get lots of ideas, okay? Then I’m afraid to throw any of them away. Sometimes they mutate. A couple months ago, this post was going to be about playing with <code>hugo list</code> in Python.</p>
<p>Yep. Datasette is pretty nifty. I’m not missing <code>q</code> at all. And I’m <em>really</em> not missing my Python <code>query</code> script.</p>
<h2 id="whats-next">What’s next?</h2>
<p>That was fun! Still got a lot ahead of me.</p>
<ul>
<li>Figuring out the quickest way to refresh the database</li>
<li>Adding those IndieWeb tables, so I can review <em>inbox/Webmention</em> updates</li>
<li>New <em>inbox/Pyinvoke</em> tasks to build, query, and explore the database</li>
<li>Fixing those tasks that still call out to my old and busted <code>query</code> Python</li>
<li>Make my Datasette site dashboard pretty</li>
</ul>
<h2 id="explore">Explore</h2>
<p>Check out some other <a href="https://github.com/simonw/datasette/wiki/Datasettes">datasettes</a> available online!</p>
<ul>
<li><a href="https://nyc-cultural-institutions.now.sh/">New York City Cultural Institutions</a></li>
<li><a href="https://fivethirtyeight.datasettes.com/fivethirtyeight/hip-hop-candidate-lyrics%2Fgenius_hip_hop_lyrics">Every mention of 2016 primary candidates in hip-hop songs</a></li>
<li><a href="https://san-francisco.datasettes.com/sf-trees-ebc2ad9/Street_Tree_List">the location of every tree in San Francisco</a> — you need to page through to see all 189,144 locations</li>
</ul>

  




  <section class="backlinks">
    <h2>Backlinks</h2>
    <nav>
      <ul>
      
      <li>
        <a href="/post/2020/05/hard-moving-on-from-perl/">hard-moving-on-from-perl</a>
      </li>
      
      <li>
        <a href="/post/2020/11/using-the-webmentionio-api/">using-the-webmentions-api</a>
      </li>
      
      <li>
        <a href="/post/2022/04/trying-nushell-on-windows/">trying-nushell-on-windows</a>
      </li>
      
      </ul>
    </nav>
  </section>



  <hr>
  

  
    <section>
      <p>
        Got a comment? A question? More of a comment than a question?
      </p>
      <p>
        Talk to me about this page on:
        
          
            <a
              href="https://hackers.town/@randomgeek/104125796417600382"
              class="u-syndication label centered fa fa-mastodon"
              title="Mastodon"
              rel="syndication"
              aria-label="Mastodon"
            >
              <span class="sr-only">mastodon</span>
            </a>
          
        
      </p>
    </section>
  
  
<hr>
<div class="footer">
    
    
      <a class="previous-post" href="https://randomgeekery.org/post/2020/05/datasette-sure-is-nifty/?ref=footer">
        <span style="font-weight:bold;">« Previous</span>
        <br>Datasette Sure Is Nifty
      </a>
    
    
      <div class="next-post">
        <a href="https://randomgeekery.org/post/2020/05/made-an-emacs-binding-for-config-quick-edit/?ref=footer">
          <span style="font-weight:bold;">Next »</span>
          <br>Made an Emacs Binding for Config Quick Edit
        </a>
      </div>
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#the-plan">The plan</a></li>
    <li><a href="#background">Background</a></li>
    <li><a href="#whats-the-problem">What’s the problem?</a></li>
    <li><a href="#whats-sqlite-utils">What’s <code>sqlite-utils</code>?</a></li>
    <li><a href="#creating-sitedb-with-sqlite-utils">Creating <code>site.db</code> with <code>sqlite-utils</code></a>
      <ul>
        <li><a href="#getting-metadata-from-hugo-and-front-matter">Getting metadata from Hugo and front matter</a></li>
        <li><a href="#loading-the-data">Loading the data</a></li>
      </ul>
    </li>
    <li><a href="#exploring-sitedb-with-datasette">Exploring <code>site.db</code> with Datasette</a>
      <ul>
        <li><a href="#year-0001-content">Year 0001 content</a></li>
      </ul>
    </li>
    <li><a href="#whats-next">What’s next?</a></li>
    <li><a href="#explore">Explore</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div><script defer data-domain="randomgeekery.org" src="https://plausible.io/js/script.js"></script>
    </body>
</html>
