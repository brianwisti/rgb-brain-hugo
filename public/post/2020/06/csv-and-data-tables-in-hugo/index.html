<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.60856f0f2ed73fb3cd2820ee548c4698ffbc4d743736e852c0e27ce4f52dfd9c.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  

<meta property="og:url" content="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/">
<meta property="og:title" content="CSV and Data Tables in Hugo">
<meta name="twitter:title" content="CSV and Data Tables in Hugo">


  <meta name="twitter:site" content="@brianwisti">



  
    <meta name="twitter:description" content="Am I reinventing reStructuredText with shortcodes? Don&#39;t judge me.">
    <meta property="og:description" content="Am I reinventing reStructuredText with shortcodes? Don&#39;t judge me.">
  



<title itemprop="name">CSV and Data Tables in Hugo - Random Geekery</title>
<meta property="og:title" content=CSV&#32;and&#32;Data&#32;Tables&#32;in&#32;Hugo&#32;-&#32;Random&#32;Geekery />
<meta name="twitter:title" content=CSV&#32;and&#32;Data&#32;Tables&#32;in&#32;Hugo&#32;-&#32;Random&#32;Geekery />
<meta itemprop="name" content=CSV&#32;and&#32;Data&#32;Tables&#32;in&#32;Hugo&#32;-&#32;Random&#32;Geekery />
<meta name="application-name" content=CSV&#32;and&#32;Data&#32;Tables&#32;in&#32;Hugo&#32;-&#32;Random&#32;Geekery />
<meta property="og:site_name" content="Random Geekery" />


<meta name="description" content="Am I reinventing reStructuredText with shortcodes? Don&#39;t judge me." />
<meta itemprop="description" content="Am I reinventing reStructuredText with shortcodes? Don&#39;t judge me." />
<meta property="og:description" content="Am I reinventing reStructuredText with shortcodes? Don&#39;t judge me." />
<meta name="twitter:description" content="Am I reinventing reStructuredText with shortcodes? Don&#39;t judge me." />


<base href="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/" />
<link rel="canonical" href="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/" itemprop="url" />
<meta name="url" content="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/" />
<meta name="twitter:url" content="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/" />
<meta property="og:url" content="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/" />


<meta property="og:updated_time" content=6006-06-05T640:07:20-0700 />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://randomgeekery.org/sitemap.xml' />

  <link
      rel="alternate"
      type="application/rss+xml"
    
        href="/index.xml"
    
      title="Random Geekery"/>



<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Random Geekery" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.121.2">


    
    

<link
    rel="stylesheet"
    href="/css/style.15361b4c24f30033251cd8947e34c41e754c9461dc117cab390ac04e365faec3.css"
    integrity="sha256-FTYbTCTzADMlHNiUfjTEHnVMlGHcEXyrOQrATjZfrsM=" 
    crossorigin="anonymous">


</head>

    <body class="">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://randomgeekery.org">
                <h1>Random Geekery</h1>
            </a>
        
    </h1>
    <p class="lead">
    Collecting my attempts to improve at tech, art, and life
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">
      
        <li class="bullet">
          <a href="/follow/">Follow</a>
        </li>
      
        <li class="bullet">
          <a href="/now/">Now</a>
        </li>
      
    </ul>
</nav>

        
  <div class="related">
    <div class="related-posts">
      <h3>Related</h3>
      <ul>
        
          <li><a href="/post/2020/05/querying-hugo-content-with-python/">Querying Hugo Content With Python</a></li>
        
          <li><a href="/post/2021/08/trying-a-thing-with-neovim/">trying a thing with neovim</a></li>
        
          <li><a href="/post/2020/05/alias-templates-in-hugo/">Alias Templates in Hugo</a></li>
        
          <li><a href="/post/2020/04/h-entry-microformat-for-indieweb-posts/">h-entry Microformat for Indieweb Posts</a></li>
        
          <li><a href="/post/2020/03/listing-hugo-content-extensions-with-raku/">Listing Hugo Content Extensions With Raku</a></li>
        
      </ul>
    </div>
  </div>



        
















        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Brian Wisti. All rights reserved.
</p>
<p class="footnote">
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
  </a>.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <nav class="masthead">
    <ul>
    
  
    
  
    
  

    <li><a href="https://randomgeekery.org/">Random Geekery</a></li>
  

    <li><a href="https://randomgeekery.org/post/">Posts</a></li>
  

    <li><a class="active" href="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/">CSV and Data Tables in Hugo</a></li>
</nav>



  <div class="info">
    <h1 class="post-title">
        <a href="https://randomgeekery.org/post/2020/06/csv-and-data-tables-in-hugo/">CSV and Data Tables in Hugo</a>
    </h1>
    
        <time datetime="2020-06-06T17:40:07-0700" class="post-date">
            June 6, 2020
        </time>
    
    
    <ul class="tags">
        
        <li class="tag-hugo">
            <a href="https://randomgeekery.org/tags/hugo">hugo</a>
        </li>
        
        <li class="tag-data">
            <a href="https://randomgeekery.org/tags/data">data</a>
        </li>
        
        <li class="tag-showing-it-anyways">
            <a href="https://randomgeekery.org/tags/showing-it-anyways">showing-it-anyways</a>
        </li>
        
        <li class="tag-csv">
            <a href="https://randomgeekery.org/tags/csv">csv</a>
        </li>
        
        <li class="tag-rst">
            <a href="https://randomgeekery.org/tags/rst">rst</a>
        </li>
        
        <li class="tag-and-a-dog">
            <a href="https://randomgeekery.org/tags/and-a-dog">and-a-dog</a>
        </li>
        
        <li class="tag-tools">
            <a href="https://randomgeekery.org/tags/tools">tools</a>
        </li>
        
    </ul>
    
    
    
    
    
    
</div>

  <p><img src="/post/2020/06/../../../attachments/img/2020/cover-2020-06-06.jpg" alt="attachments/img/2020/cover-2020-06-06.jpg"/>
I&rsquo;ve been looking at screenshots all day. Here&rsquo;s Loud Dog instead.</p>
<p><a href="/card/tldr/">tldr</a>: Use <a href="/card/hugo/">Hugo</a>’s <a href="https://gohugo.io/functions/transform.unmarshal/"><code>transform.Unmarshal</code></a> to turn strings into data structures, which you can feed into a table template. But sometimes <a href="https://gohugo.io/functions/split/"><code>split</code></a> makes more sense.</p>
<p>I figured out how to write Hugo <a href="https://gohugo.io/templates/shortcode-templates/">shortcodes</a> to generate <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/table">tables</a> from <a href="/card/csv/">CSV</a> and other formats. Didn’t even occur to me that it was possible — or this easy — so I had to share.</p>
<p>This approach only works as-is for uniform, shallow structures: every row has the same number of fields, and every field translates cleanly to a string. If you have more complex structures, you need more complex templates.</p>
<h2 id="why">Why?</h2>
<p>Most Markdown parsers include some way to handle tables. Usually it involves
drawing your table with ASCII characters. Something like this, from an older
post of mine about <a href="/post/2017/01/elscreen/">elscreen</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">Function            | Keys    | Description
</span></span><span class="line"><span class="cl">--------------------|---------|-------------------------------------
</span></span><span class="line"><span class="cl"><span class="sb">`elscreen-create`</span>   | <span class="sb">`C-z c`</span> | Create a new screen and switch to it.
</span></span><span class="line"><span class="cl"><span class="sb">`elscreen-next`</span>     | <span class="sb">`C-z n`</span> | Cycle to the next screen
</span></span><span class="line"><span class="cl"><span class="sb">`elscreen-previous`</span> | <span class="sb">`C-z p`</span> | Cycle to the previous screen
</span></span><span class="line"><span class="cl"><span class="sb">`elscreen-kill`</span>     | <span class="sb">`C-z k`</span> | Kill the current screen
</span></span><span class="line"><span class="cl"><span class="sb">`elscreen-help`</span>     | <span class="sb">`C-z ?`</span> | Show ElScreen key bindings
</span></span></code></pre></div><p>I can read it just fine, but I find managing Markdown tables tedious without editor extensions. I want easy tables. I don’t care if they look like a table while I’m editing them. If I can copy and paste something into a shortcode? Even better.</p>
<p><a href="/card/restructuredtext/">card/reStructuredText</a> and <a href="/card/asciidoctor/">card/Asciidoctor</a> both provide table-handling approaches beyond drawing ASCII, though the default <a href="https://docutils.sourceforge.io/rst.html">rst table</a> is lovely if you <em>do</em> like fiddling with columns. I looked at them for shortcode inspiration — particularly rst’s <a href="https://docutils.sourceforge.io/docs/ref/rst/directives.html#id4">csv-table</a> and <a href="https://docutils.sourceforge.io/docs/ref/rst/directives.html#list-table">list-table</a> directives.</p>
<h2 id="csv-tables">CSV tables</h2>
<p>First up: CSV, &ldquo;Comma-Separated Values&rdquo;. I work a fair amount with CSV on the command line. I may want to copy and paste something into a table for a blog post every once in a while.</p>
<p>A <code>csv-table</code> shortcode could contain any CSV data. Maybe something from the <a href="https://github.com/awesomedata/awesome-public-datasets">Awesome Public Datasets</a>? Nah, I’ll just use my <a href="https://plausible.io">https://plausible.io</a> visitor count for the last week.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="nt">csv-table</span> <span class="p">&gt;</span>}}
</span></span><span class="line"><span class="cl">Date,Visitors
</span></span><span class="line"><span class="cl">2020-05-28,66
</span></span><span class="line"><span class="cl">2020-05-29,43
</span></span><span class="line"><span class="cl">2020-05-30,33
</span></span><span class="line"><span class="cl">2020-05-31,44
</span></span><span class="line"><span class="cl">2020-06-01,74
</span></span><span class="line"><span class="cl">2020-06-02,62
</span></span><span class="line"><span class="cl">2020-06-03,73
</span></span><span class="line"><span class="cl">2020-06-04,28
</span></span><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="p">/</span><span class="nt">csv-table</span> <span class="p">&gt;</span>}}
</span></span></code></pre></div><p>My shortcode receives that data as a string in the <a href="https://gohugo.io/templates/shortcode-templates/#inner"><code>.Inner</code></a> variable. How to turn that string into a table?</p>
<h3 id="just-use-transformunmarshal">Just use <code>transform.Unmarshal</code></h3>
<p>Give <code>transform.Unmarshal</code> a formatted string, and it gives you back a data structure. CSV text becomes an array of arrays, which we turn into a table by iterating through everything with <a href="https://gohugo.io/functions/range/"><code>range</code></a>.</p>
<div class="highlight" title="layouts/shortcodes/csv-table.html"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="nt">code</span> <span class="na">file</span><span class="o">=</span><span class="s">&#34;layouts/shortcodes/csv-table.html&#34;</span> <span class="p">&gt;</span>}}
</span></span><span class="line"><span class="cl">{{ $rows := .Inner | transform.Unmarshal }}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  {{ range $rows }}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      {{ range . }} <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ . }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span> {{ end }}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  {{ end }}
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="p">/</span><span class="nt">code</span> <span class="p">&gt;</span>}}
</span></span></code></pre></div><p>Voila! Instant table!</p>
<p><img src="/post/2020/06/attachments/img/2020/csv-table-no-header.png" alt="A CSV table"/></p>
<p>Not bad, but it could be better.</p>
<ul>
<li>that first row provides column names, which works better as table headers than just another row</li>
<li>I prefer a particular style for numeric columns</li>
<li>what about a summary caption?</li>
</ul>
<p>Give me a minute.</p>
<h3 id="fine-tuning-the-table-with-parameters">Fine-tuning the table with parameters</h3>
<p>I’ll add a parameter for the caption. Maybe another parameter indicating whether to expect a header row, since the first row of CSV doesn’t <em>always</em> contain column names.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="nt">csv-table</span> <span class="na">caption</span><span class="o">=</span><span class="s">&#34;Site visitors, 2020-05-28 to 2020-06-04&#34;</span> <span class="na">header</span><span class="o">=</span><span class="s">true</span> <span class="p">&gt;</span>}}
</span></span><span class="line"><span class="cl">Date,Visitors
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="p">/</span><span class="nt">csv-table</span> <span class="p">&gt;</span>}}
</span></span></code></pre></div><p>Now that I know how I want to use the shortcode, it’s time to implement the details.</p>
<div class="highlight" title="layouts/shortcodes/csv/table.html"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{ $caption := .Get &#34;caption&#34; }}
</span></span><span class="line"><span class="cl">{{ $useHeaderRow := .Get &#34;header&#34; }}
</span></span><span class="line"><span class="cl">{{ $rows := .Inner | transform.Unmarshal }}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  {{ with $caption }}<span class="p">&lt;</span><span class="nt">caption</span><span class="p">&gt;</span>{{ . }}<span class="p">&lt;/</span><span class="nt">caption</span><span class="p">&gt;</span>{{ end }}
</span></span><span class="line"><span class="cl">  {{ if $useHeaderRow }}
</span></span><span class="line"><span class="cl">    {{ $headerRow := index $rows 0 }}
</span></span><span class="line"><span class="cl">    {{ $rows = after 1 $rows }}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span> {{ range $headerRow }} <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>{{ . }}<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span> {{ end }} <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  {{ end }}
</span></span><span class="line"><span class="cl">  {{ range $rows }}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      {{ range . }}
</span></span><span class="line"><span class="cl">        {{ if (findRE &#34;^\\d+$&#34; .) }}
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;numeric&#34;</span><span class="p">&gt;</span>{{ . }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        {{ else }}
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ . }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        {{ end }}
</span></span><span class="line"><span class="cl">      {{ end }}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  {{ end }}
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span></code></pre></div><ul>
<li>if there’s a header row, <a href="https://gohugo.io/functions/after/"><code>after</code></a> lets me skip past it when building the data rows</li>
<li>The regular expression I hand to <a href="https://gohugo.io/functions/findre/"><code>findRE</code></a> is a little naive, but it works for today</li>
</ul>
<p>Better!</p>
<p><img src="/post/2020/06/attachments/img/2020/csv-table.png" alt="A CSV table with headers and a caption"/></p>
<p>I still need to fiddle with my styles. This table’s a little wide for these
values. Maybe later.</p>
<p>CSV is great, but <code>transform.Unmarshal</code> supports other formats. What about those?</p>
<h2 id="digression-data-tables">Digression: data tables</h2>
<p>I got a little carried away when I learned how much <code>transform.Unmarshal</code> can
do. You could get a data structure from CSV, <a href="https://json.org">JSON</a>, <a href="/card/toml/">card/TOML</a>, or <a href="/card/yaml/">card/YAML</a>!</p>
<p>What about — what about a <strong>data</strong> table? Mind you, I’m not talking about Hugo <a href="https://gohugo.io/templates/data-templates/">data files</a> or <a href="https://gohugo.io/templates/data-templates/#data-driven-content"><code>getJSON</code></a>. That’s a great idea for later.</p>
<p>No, I’m talking about something similar to the <code>csv-table</code> case: arrays of JSON objects you paste in from somewhere else to add a little information to your blog post.</p>
<p>Heck, you don’t even need parameters. You could put caption and header details <em>in</em> the data! Might be a good idea to use a list of desired columns instead of a simple flag. That way we can pick and choose columns without editing the row objects.</p>
<p>Suppose I extracted details for the US and a couple neighbors from <a href="https://covid19api.com/">COVID19API</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="nt">data-table</span> <span class="p">&gt;</span>}}
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;caption&#34;: &#34;COVID-19 updates for 6 Jun 2020&#34;,
</span></span><span class="line"><span class="cl">  &#34;headers&#34;: [
</span></span><span class="line"><span class="cl">      &#34;Country&#34;,
</span></span><span class="line"><span class="cl">      &#34;NewConfirmed&#34;,
</span></span><span class="line"><span class="cl">      &#34;TotalConfirmed&#34;,
</span></span><span class="line"><span class="cl">      &#34;NewDeaths&#34;,
</span></span><span class="line"><span class="cl">      &#34;TotalDeaths&#34;,
</span></span><span class="line"><span class="cl">      &#34;NewRecovered&#34;,
</span></span><span class="line"><span class="cl">      &#34;TotalRecovered&#34;
</span></span><span class="line"><span class="cl">  ],
</span></span><span class="line"><span class="cl">  &#34;rows&#34;: [
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;Country&#34;: &#34;Canada&#34;,
</span></span><span class="line"><span class="cl">      &#34;CountryCode&#34;: &#34;CA&#34;,
</span></span><span class="line"><span class="cl">      &#34;Slug&#34;: &#34;canada&#34;,
</span></span><span class="line"><span class="cl">      &#34;NewConfirmed&#34;: 1356,
</span></span><span class="line"><span class="cl">      &#34;TotalConfirmed&#34;: 191894,
</span></span><span class="line"><span class="cl">      &#34;NewDeaths&#34;: 122,
</span></span><span class="line"><span class="cl">      &#34;TotalDeaths&#34;: 15554,
</span></span><span class="line"><span class="cl">      &#34;NewRecovered&#34;: 890,
</span></span><span class="line"><span class="cl">      &#34;TotalRecovered&#34;: 53074,
</span></span><span class="line"><span class="cl">      &#34;Date&#34;: &#34;2020-06-06T23:48:14Z&#34;
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;Country&#34;: &#34;Mexico&#34;,
</span></span><span class="line"><span class="cl">      &#34;CountryCode&#34;: &#34;MX&#34;,
</span></span><span class="line"><span class="cl">      &#34;Slug&#34;: &#34;mexico&#34;,
</span></span><span class="line"><span class="cl">      &#34;NewConfirmed&#34;: 4346,
</span></span><span class="line"><span class="cl">      &#34;TotalConfirmed&#34;: 110026,
</span></span><span class="line"><span class="cl">      &#34;NewDeaths&#34;: 625,
</span></span><span class="line"><span class="cl">      &#34;TotalDeaths&#34;: 13170,
</span></span><span class="line"><span class="cl">      &#34;NewRecovered&#34;: 3083,
</span></span><span class="line"><span class="cl">      &#34;TotalRecovered&#34;: 77841,
</span></span><span class="line"><span class="cl">      &#34;Date&#34;: &#34;2020-06-06T23:48:14Z&#34;
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;Country&#34;: &#34;United States of America&#34;,
</span></span><span class="line"><span class="cl">      &#34;CountryCode&#34;: &#34;US&#34;,
</span></span><span class="line"><span class="cl">      &#34;Slug&#34;: &#34;united-states&#34;,
</span></span><span class="line"><span class="cl">      &#34;NewConfirmed&#34;: 24720,
</span></span><span class="line"><span class="cl">      &#34;TotalConfirmed&#34;: 1897380,
</span></span><span class="line"><span class="cl">      &#34;NewDeaths&#34;: 921,
</span></span><span class="line"><span class="cl">      &#34;TotalDeaths&#34;: 109132,
</span></span><span class="line"><span class="cl">      &#34;NewRecovered&#34;: 6704,
</span></span><span class="line"><span class="cl">      &#34;TotalRecovered&#34;: 491706,
</span></span><span class="line"><span class="cl">      &#34;Date&#34;: &#34;2020-06-06T23:48:14Z&#34;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  ]
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="p">/</span><span class="nt">data-table</span> <span class="p">&gt;</span>}}
</span></span></code></pre></div><p>The logic looks similar to <code>csv-table</code>, with adjustments for data format differences.</p>
<div class="highlight" title="layouts/shortcodes/data-table.html"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{ $table := .Inner | transform.Unmarshal }}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  {{ with $table.caption }} <span class="p">&lt;</span><span class="nt">caption</span><span class="p">&gt;</span>{{ . | markdownify }}<span class="p">&lt;/</span><span class="nt">caption</span><span class="p">&gt;</span> {{ end }}
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      {{ range $table.headers }} <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>{{ . | humanize }}<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span> {{ end }}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {{ range $table.rows }}
</span></span><span class="line"><span class="cl">      {{ $row := . }}
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        {{ range $table.headers }}
</span></span><span class="line"><span class="cl">          {{ with (index $row .) }}
</span></span><span class="line"><span class="cl">            {{ if (findRE &#34;^\\d+$&#34; .) }}
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;numeric&#34;</span><span class="p">&gt;</span>{{ . | lang.NumFmt 0 }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            {{ else }}
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ . }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            {{ end }}
</span></span><span class="line"><span class="cl">          {{ end }}
</span></span><span class="line"><span class="cl">        {{ end }}
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {{ end }}
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>These header fields use <a href="https://en.wikipedia.org/wiki/Camel_case">camel case</a> names like &ldquo;TotalRecovered&rdquo;. Piping them through <a href="https://gohugo.io/functions/humanize/"><code>humanize</code></a> and <a href="https://gohugo.io/functions/title/"><code>title</code></a> transforms them into distinct capitalized words: &ldquo;Total Recovered.&rdquo; That’s easier for me to read in a formatted table.</p>
<p>And — sadly, considering that the topic is <a href="https://www.mayoclinic.org/diseases-conditions/coronavirus/symptoms-causes/syc-20479963">COVID-19</a> cases — <a href="https://gohugo.io/functions/numfmt/"><code>lang.NumFmt</code></a> makes large numbers more readable.</p>
<p><img src="/post/2020/06/attachments/img/2020/data-table.png" alt="A data table"/></p>
<p>Wonderful! Wonderful formatting, anyways. The details are pretty sobering. People! Wash your hands and wear a mask!</p>
<p>There’s really only one <em>slight</em> problem with <code>data-table</code>. I don’t need it. Not today, anyways.</p>
<h2 id="what-i-need-list-tables">What I need: list tables</h2>
<p>What about that first table I mentioned? You know, the <code>elscreen</code> quick reference? <em>That</em> is the kind of table I need a shortcode for. Something like a reStructuredText <code>list-table</code>, or <a href="https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#tables">Asciidoctor tables</a>.</p>
<p>I tried different approaches with <code>transform.Unmarshal</code> and mashing YAML, TOML, or JSON lists into something useful. That got frustratingly brittle. Time to step back and reevaluate. What’s the simplest structure that still does what I want?</p>
<p>Maybe something line-oriented?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="nt">list-table</span> <span class="na">caption</span><span class="o">=</span><span class="s">&#34;Common `elscreen` commands&#34;</span> <span class="na">header</span><span class="o">=</span><span class="s">true</span> <span class="p">&gt;</span>}}
</span></span><span class="line"><span class="cl">Function
</span></span><span class="line"><span class="cl">Keys
</span></span><span class="line"><span class="cl">Description
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">`elscreen-create`
</span></span><span class="line"><span class="cl">`C-z c`
</span></span><span class="line"><span class="cl">Create a new screen and switch to it.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">`elscreen-next`
</span></span><span class="line"><span class="cl">`C-z n`
</span></span><span class="line"><span class="cl">Cycle to the next screen
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">`elscreen-previous`
</span></span><span class="line"><span class="cl">`C-z p`
</span></span><span class="line"><span class="cl">Cycle to the previous screen
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">`elscreen-kill`
</span></span><span class="line"><span class="cl">`C-z k`
</span></span><span class="line"><span class="cl">Kill the current screen
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">`elscreen-help`
</span></span><span class="line"><span class="cl">`C-z ?`
</span></span><span class="line"><span class="cl">Show ElScreen key bindings
</span></span><span class="line"><span class="cl">{{<span class="p">&lt;</span> <span class="p">/</span><span class="nt">list-table</span> <span class="p">&gt;</span>}}
</span></span></code></pre></div><p>Every line contains one field. Blank lines separate table rows. No special prefix characters needed, since everything’s already in a shortcode.</p>
<p>I like it. Easy to write, easy to read, and easy to parse with <a href="https://gohugo.io/functions/split/"><code>split</code></a>. Well — you need to <a href="https://gohugo.io/functions/trim/"><code>trim</code></a> a leading newline because of how <code>.Inner</code> gets handed off, but that’s the only wrinkle so far.</p>
<div class="highlight" title="layouts/shortcodes/list-table.html"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">{{ $caption := .Get &#34;caption&#34; }}
</span></span><span class="line"><span class="cl">{{ $useHeaderRow := .Get &#34;header&#34; }}
</span></span><span class="line"><span class="cl">{{ $rows := split (trim .Inner &#34;\n&#34;) &#34;\n\n&#34; }}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;table&gt;
</span></span><span class="line"><span class="cl">  {{ with $caption }}
</span></span><span class="line"><span class="cl">    &lt;caption&gt;{{ . }}&lt;/caption&gt;
</span></span><span class="line"><span class="cl">  {{ end }}
</span></span><span class="line"><span class="cl">  {{ if $useHeaderRow }}
</span></span><span class="line"><span class="cl">    {{ $headerRow := index $rows 0 }}
</span></span><span class="line"><span class="cl">    {{ $rows = after 1 $rows }}
</span></span><span class="line"><span class="cl">    &lt;tr&gt;
</span></span><span class="line"><span class="cl">      {{ range (split $headerRow &#34;\n&#34;) }} &lt;th&gt;{{ . | markdownify }}&lt;/th&gt; {{ end }}
</span></span><span class="line"><span class="cl">    &lt;/tr&gt;
</span></span><span class="line"><span class="cl">  {{ end }}
</span></span><span class="line"><span class="cl">  {{ range $rows }}
</span></span><span class="line"><span class="cl">    &lt;tr&gt;
</span></span><span class="line"><span class="cl">      {{ range (split . &#34;\n&#34;) }}
</span></span><span class="line"><span class="cl">        {{ if (findRE &#34;^\\d+$&#34; .) }}
</span></span><span class="line"><span class="cl">          &lt;td class=&#34;numeric&#34;&gt;{{ . }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">        {{ else }}
</span></span><span class="line"><span class="cl">          &lt;td&gt;{{ . | markdownify }}&lt;/td&gt;
</span></span><span class="line"><span class="cl">        {{ end }}
</span></span><span class="line"><span class="cl">      {{ end }}
</span></span><span class="line"><span class="cl">    &lt;/tr&gt;
</span></span><span class="line"><span class="cl">  {{ end }}
</span></span><span class="line"><span class="cl">&lt;/table&gt;
</span></span></code></pre></div><p><img src="/post/2020/06/attachments/img/2020/list-table.png" alt="A list table!"/></p>
<p>Perfect. This will keep me going for a while. Time to stop before I get too clever.</p>
<p>Try to keep the original goal in mind when working on a thing. I could try making a universal data table shortcode. I don’t <em>need</em> a universal data table shortcode. Not yet, anyways.</p>
<h2 id="what-next">What Next?</h2>
<ul>
<li>Make a universal data table shortcode.</li>
</ul>
<p>Okay not really, but I can see a few specific conveniences I’d like to add eventually:</p>
<ul>
<li>improve the numeric value handling to recognize and properly format decimal values, including money.</li>
<li>format dates and timestamps</li>
<li>support building a simple table from <code>.Site.Data</code> or <code>getJSON</code></li>
<li>control column widths</li>
<li>control column alignment</li>
<li>refactor into partials where I can, so there’s less duplication between <code>csv-table</code>, <code>list-table</code>, and <code>data-table</code></li>
</ul>
<p>I might steal more ideas from reStructuredText. It’s fun!</p>
<p>Speaking of fun, the dog wants to go outside again.</p>

  






  <hr>
  

  
    <section>
      <p>
        Got a comment? A question? More of a comment than a question?
      </p>
      <p>
        Talk to me about this page on:
        
          
            <a
              href="https://hackers.town/@randomgeek/104300219652879640"
              class="u-syndication label centered fa fa-mastodon"
              title="Mastodon"
              rel="syndication"
              aria-label="Mastodon"
            >
              <span class="sr-only">mastodon</span>
            </a>
          
        
      </p>
    </section>
  
  
<hr>
<div class="footer">
    
    
      <a class="previous-post" href="https://randomgeekery.org/post/2020/06/wanted-a-uses-page-made-a-config-section/?ref=footer">
        <span style="font-weight:bold;">« Previous</span>
        <br>Wanted a uses page, made a config section
      </a>
    
    
      <div class="next-post">
        <a href="https://randomgeekery.org/post/2020/06/working-on-breadcrumbs/?ref=footer">
          <span style="font-weight:bold;">Next »</span>
          <br>Working on Breadcrumbs
        </a>
      </div>
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#why">Why?</a></li>
    <li><a href="#csv-tables">CSV tables</a>
      <ul>
        <li><a href="#just-use-transformunmarshal">Just use <code>transform.Unmarshal</code></a></li>
        <li><a href="#fine-tuning-the-table-with-parameters">Fine-tuning the table with parameters</a></li>
      </ul>
    </li>
    <li><a href="#digression-data-tables">Digression: data tables</a></li>
    <li><a href="#what-i-need-list-tables">What I need: list tables</a></li>
    <li><a href="#what-next">What Next?</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div><script defer data-domain="randomgeekery.org" src="https://plausible.io/js/script.js"></script>
    </body>
</html>
