<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.60856f0f2ed73fb3cd2820ee548c4698ffbc4d743736e852c0e27ce4f52dfd9c.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  

<meta property="og:url" content="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/">
<meta property="og:title" content="Parrot Babysteps 07 - Writing Subroutines">
<meta name="twitter:title" content="Parrot Babysteps 07 - Writing Subroutines">


  <meta name="twitter:site" content="@brianwisti">



  
    <meta name="twitter:description" content="Introduction We accomplished quite a bit in parrot-babysteps-06-files-and-hashes. We figured out how to parse a 20 MB star catalog and search for information that we thought could be important. The only problem is that it was turning to spaghetti. Even though it had barely 100 lines of code, it was becoming a bigger challenge to figure out what was going on or how to add new features.
Today we&rsquo;re going to streamline the code somewhat by wrapping that complexity in subroutines.">
    <meta property="og:description" content="Introduction We accomplished quite a bit in parrot-babysteps-06-files-and-hashes. We figured out how to parse a 20 MB star catalog and search for information that we thought could be important. The only problem is that it was turning to spaghetti. Even though it had barely 100 lines of code, it was becoming a bigger challenge to figure out what was going on or how to add new features.
Today we&rsquo;re going to streamline the code somewhat by wrapping that complexity in subroutines.">
  



<title itemprop="name">Parrot Babysteps 07 - Writing Subroutines - Random Geekery</title>
<meta property="og:title" content=Parrot&#32;Babysteps&#32;07&#32;-&#32;Writing&#32;Subroutines&#32;-&#32;Random&#32;Geekery />
<meta name="twitter:title" content=Parrot&#32;Babysteps&#32;07&#32;-&#32;Writing&#32;Subroutines&#32;-&#32;Random&#32;Geekery />
<meta itemprop="name" content=Parrot&#32;Babysteps&#32;07&#32;-&#32;Writing&#32;Subroutines&#32;-&#32;Random&#32;Geekery />
<meta name="application-name" content=Parrot&#32;Babysteps&#32;07&#32;-&#32;Writing&#32;Subroutines&#32;-&#32;Random&#32;Geekery />
<meta property="og:site_name" content="Random Geekery" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/" />
<link rel="canonical" href="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/" itemprop="url" />
<meta name="url" content="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/" />
<meta name="twitter:url" content="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/" />
<meta property="og:url" content="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/" />


<meta property="og:updated_time" content=6010-06-12T100:00:09-0700 />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://randomgeekery.org/sitemap.xml' />

  <link
      rel="alternate"
      type="application/rss+xml"
    
        href="/index.xml"
    
      title="Random Geekery"/>



<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Random Geekery" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.121.2">


    
    

<link
    rel="stylesheet"
    href="/css/style.15361b4c24f30033251cd8947e34c41e754c9461dc117cab390ac04e365faec3.css"
    integrity="sha256-FTYbTCTzADMlHNiUfjTEHnVMlGHcEXyrOQrATjZfrsM=" 
    crossorigin="anonymous">


</head>

    <body class="">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://randomgeekery.org">
                <h1>Random Geekery</h1>
            </a>
        
    </h1>
    <p class="lead">
    Collecting my attempts to improve at tech, art, and life
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">
      
        <li class="bullet">
          <a href="/follow/">Follow</a>
        </li>
      
        <li class="bullet">
          <a href="/now/">Now</a>
        </li>
      
    </ul>
</nav>

        
  <div class="related">
    <div class="related-posts">
      <h3>Related</h3>
      <ul>
        
          <li><a href="/post/2009/12/parrot-babysteps-08-testing-with-testmore/">Parrot Babysteps 08 - Testing With Test::More</a></li>
        
          <li><a href="/post/2009/10/parrot-babysteps-06-files-and-hashes/">Parrot Babysteps 06 - Files and Hashes</a></li>
        
          <li><a href="/post/2009/09/parrot-babysteps-05-more-about-arrays/">Parrot Babysteps 05 - More About Arrays</a></li>
        
          <li><a href="/post/2009/09/parrot-babysteps-04-adding-command-line-arguments/">Parrot Babysteps 04 - Adding Command Line Arguments</a></li>
        
          <li><a href="/post/2009/09/parrot-babysteps-03-simple-control-structures/">Parrot Babysteps 03 - Simple Control Structures</a></li>
        
      </ul>
    </div>
  </div>



        
















        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Brian Wisti. All rights reserved.
</p>
<p class="footnote">
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
  </a>.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <nav class="masthead">
    <ul>
    
  
    
  
    
  

    <li><a href="https://randomgeekery.org/">Random Geekery</a></li>
  

    <li><a href="https://randomgeekery.org/post/">Posts</a></li>
  

    <li><a class="active" href="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/">Parrot Babysteps 07 - Writing Subroutines</a></li>
</nav>



  <div class="info">
    <h1 class="post-title">
        <a href="https://randomgeekery.org/post/2009/10/parrot-babysteps-07-writing-subroutines/">Parrot Babysteps 07 - Writing Subroutines</a>
    </h1>
    
        <time datetime="2009-10-06T00:00:00-0700" class="post-date">
            October 6, 2009
        </time>
    
    
    <ul class="tags">
        
        <li class="tag-parrot">
            <a href="https://randomgeekery.org/tags/parrot">parrot</a>
        </li>
        
        <li class="tag-learn">
            <a href="https://randomgeekery.org/tags/learn">learn</a>
        </li>
        
        <li class="tag-coolnamehere">
            <a href="https://randomgeekery.org/tags/coolnamehere">coolnamehere</a>
        </li>
        
    </ul>
    
    
    
    
        <p class="seriesname">
            Series: <a href="https://randomgeekery.orgseries/">[Parrot Babysteps]</a>
        </p>
    
    
    
</div>

  <h2 id="introduction">Introduction</h2>
<p>We accomplished quite a bit in <a href="/post/2009/10/parrot-babysteps-06-files-and-hashes/">parrot-babysteps-06-files-and-hashes</a>.
We figured out how to parse a 20 MB star catalog and search for information that
we thought could be important. The only problem is that it was turning to
spaghetti. Even though it had barely 100 lines of code, it was becoming a bigger
challenge to figure out what was going on or how to add new features.</p>
<p>Today we&rsquo;re going to streamline the code somewhat by wrapping that complexity
in subroutines.  The <a href="/card/parrot/">Parrot</a> Book has a <a href="http://docs.parrot.org/parrot/latest/html/docs/book/pir/ch06_subroutines.pod.html">sizable chapter discussing subroutines</a>.
I won&rsquo;t be spending much time exploring the depths of subroutines, because
that would take me far beyond what is appropriate for a babystep. However, a
quick glance at the chapter should suggest that Parrot subroutines are quite
powerful and worth deeper exploration on your own.</p>
<h2 id="subroutines">Subroutines</h2>
<p>We&rsquo;ve been working with subroutines since <a href="/post/2009/07/parrot-babysteps-01-getting-started/">parrot-babysteps-01-getting-started</a> Every Parrot application has a subroutine tagged as <code>:main</code> to show that it contains the main logic for the program. Let&rsquo;s start adding our own supplementary subroutines.</p>
<p>Our first function will encapsulate the display of star highlights.</p>
<pre tabindex="0"><code># example-07-01

.loadlib &#39;io_ops&#39;

.sub &#39;main&#39; :main

    load_bytecode &#39;String/Utils.pbc&#39;

    .const string DELIMITER  = &#39;,&#39;
    .local pmc    chomp
    .local string filename
    .local pmc    data_file
    .local string current_line
    .local pmc    field_names
    .local int    field_count
    .local int    current_field_index
    .local string current_field_name
    .local string current_field_value
    .local pmc    star_data
    .local pmc    star
    .local string star_name
    .local string star_spectrum
    .local pmc    sol
    .local string sol_spectrum
    .local int    matching_count
    .local int    unnamed_match_count

    chomp         = get_global [&#39;String&#39;;&#39;Utils&#39;], &#39;chomp&#39;
    filename      = &#39;hygxyz.csv&#39;
    data_file     = open filename, &#39;r&#39;
    current_line  = readline data_file
    current_line  = chomp(current_line)
    field_names   = split DELIMITER, current_line
    field_count   = field_names

    current_line = readline data_file
    current_line = chomp(current_line)
    star_data = split DELIMITER, current_line
    current_field_index = 0
    sol = new &#39;Hash&#39;

  ASSIGN_NEXT_SOL_FIELD:
    if current_field_index &gt;= field_count goto FIND_MATCHING_STARS
    current_field_name = field_names[current_field_index]
    current_field_value = star_data[current_field_index]
    sol[current_field_name] = current_field_value
    current_field_index += 1
    goto ASSIGN_NEXT_SOL_FIELD

  FIND_MATCHING_STARS:
    sol_spectrum = sol[&#39;Spectrum&#39;]
    matching_count = 0
    unnamed_match_count = 0
    # We want to show Sol&#39;s details as well as other matches.
    say_star_details(sol)

  LOAD_NEXT_STAR:
    unless data_file goto END
    current_line = readline data_file
    current_line = chomp(current_line)
    star_data = split DELIMITER, current_line
    current_field_index = 0
    star = new &#39;Hash&#39;

  ASSIGN_NEXT_STAR_FIELD:
    if current_field_index &gt;= field_count goto EXAMINE_STAR
    current_field_name = field_names[current_field_index]
    current_field_value = star_data[current_field_index]
    star[current_field_name] = current_field_value
    current_field_index += 1
    goto ASSIGN_NEXT_STAR_FIELD

  EXAMINE_STAR:
    star_spectrum = star[&#39;Spectrum&#39;]
    if star_spectrum == sol_spectrum goto REMEMBER_MATCH
    goto LOAD_NEXT_STAR

  REMEMBER_MATCH:
    matching_count += 1
    star_name = star[&#39;ProperName&#39;]
    if star_name goto DISPLAY_STAR_DETAILS
    unnamed_match_count += 1
    goto LOAD_NEXT_STAR

  DISPLAY_STAR_DETAILS:
    say_star_details(star)
    goto LOAD_NEXT_STAR

  END:
    close data_file
    print matching_count
    print &#34; stars exactly matched Sol&#39;s spectrum &#34;
    say sol_spectrum
    print unnamed_match_count
    say &#39; have no proper name&#39;

.end

.sub say_star_details
    .param pmc star

    .local string star_name
    .local string star_spectrum
    .local string star_distance

    star_name = star[&#39;ProperName&#39;]
    star_spectrum = star[&#39;Spectrum&#39;]
    star_distance = star[&#39;Distance&#39;]

    print &#34;&lt;Name: &#34;
    print star_name
    print &#34;, Spectrum: &#34;
    print star_spectrum
    print &#34;, Distance: &#34;
    print star_distance
    say &#34;&gt;&#34;
.end
</code></pre><p>To create a subroutine that will get used by your <code>:main</code> sub, all
you need to do is declare a <code>.sub</code>.</p>
<pre tabindex="0"><code>.sub say_star_details
.end
</code></pre><p>I like my subroutine names to clearly describe the task being accomplished,
to minimize the guesswork when I come back to code later.</p>
<p>This subroutine accepts a single parameter: a Hash describing the star to be
printed. We learned <a href="/post/2009/09/parrot-babysteps-04-adding-command-line-arguments/">a few steps ago</a>
that the <code>.param</code> directive declares a parameter for your subroutine.</p>
<pre tabindex="0"><code>.sub say_star_details
    .param pmc star
.end
</code></pre><p>The subroutine body in this case is going to be a copy and paste of the
<code>DISPLAY_STAR_DETAILS</code> code chunk, along with declarations of <code>.local</code>
variables needed to make it work.</p>
<pre tabindex="0"><code>.sub say_star_details
    .param pmc star

    .local string star_name
    .local string star_spectrum
    .local string star_distance

    star_name = star[&#39;ProperName&#39;]
    star_spectrum = star[&#39;Spectrum&#39;]
    star_distance = star[&#39;Distance&#39;]

    print &#34;&lt;Name: &#34;
    print star_name
    print &#34;, Spectrum: &#34;
    print star_spectrum
    print &#34;, Distance: &#34;
    print star_distance
    say &#34;&gt;&#34;
.end
</code></pre><p>We no longer care about stellar distances in our main code, so we can safely
remove the <code>.local string star_distance</code> directive from <code>main</code>.</p>
<p>Now we can rewrite our code to display Sol&rsquo;s details. Remember that subroutines
require that their parameters be wrapped in parentheses.</p>
<pre tabindex="0"><code># We want to show Sol&#39;s details as well as other matches.
say_star_details(sol)
</code></pre><p>We could have also wrapped <code>say_star_details</code> in quotes, but it&rsquo;s only required
when our subroutines have non-ASCII characters - that is, characters outside the
range of what we consider &ldquo;normal&rdquo; characters in the United States. Still, I won&rsquo;t
complain if you&rsquo;re devoted to good form and prefer to show those subroutine calls
as:</p>
<pre tabindex="0"><code>&#39;say_star_details&#39;(sol)
</code></pre><p>The <code>DISPLAY_STAR_DETAILS</code> chunk becomes just a few lines:</p>
<pre tabindex="0"><code>DISPLAY_STAR_DETAILS:
  say_star_details(star) # or &#39;say_star_details&#39;(star)
  goto LOAD_NEXT_STAR
</code></pre><p>Does it produce the same result as the code we ran before?</p>
<pre tabindex="0"><code>$ parrot example-07-01.pir 
&lt;Name: Sol, Spectrum: G2V, Distance: 0.000004848&gt;
&lt;Name: Rigel Kentaurus A, Spectrum: G2V, Distance: 1.34749097181049&gt;
568 stars exactly matched Sol&#39;s spectrum G2V
567 have no proper name
</code></pre><p>It sure does. The code is still rather awkward, though. How about we add a
subroutine for transforming a line from the text file into star data?</p>
<h2 id="returning-values">Returning Values</h2>
<pre tabindex="0"><code># example-07-02

.loadlib &#39;io_ops&#39;

.sub &#39;main&#39; :main

    load_bytecode &#39;String/Utils.pbc&#39;

    .const string DELIMITER  = &#39;,&#39;
    .local pmc    chomp
    .local string filename
    .local pmc    data_file
    .local string current_line
    .local pmc    field_names
    .local pmc    star_data
    .local pmc    star
    .local string star_name
    .local string star_spectrum
    .local pmc    sol
    .local string sol_spectrum
    .local int    matching_count
    .local int    unnamed_match_count

    chomp         = get_global [&#39;String&#39;;&#39;Utils&#39;], &#39;chomp&#39;
    filename      = &#39;hygxyz.csv&#39;
    data_file     = open filename, &#39;r&#39;
    current_line  = readline data_file
    current_line  = chomp(current_line)
    field_names   = split DELIMITER, current_line

    current_line = readline data_file
    current_line = chomp(current_line)
    star_data = split DELIMITER, current_line
    sol = extract_star_details(field_names, star_data)

  FIND_MATCHING_STARS:
    sol_spectrum = sol[&#39;Spectrum&#39;]
    matching_count = 0
    unnamed_match_count = 0
    # We want to show Sol&#39;s details as well as other matches.
    say_star_details(sol)

  LOAD_NEXT_STAR:
    unless data_file goto END
    current_line = readline data_file
    current_line = chomp(current_line)
    star_data    = split DELIMITER, current_line
    star         = extract_star_details(field_names, star_data)

  EXAMINE_STAR:
    star_spectrum = star[&#39;Spectrum&#39;]
    if star_spectrum == sol_spectrum goto REMEMBER_MATCH
    goto LOAD_NEXT_STAR

  REMEMBER_MATCH:
    matching_count += 1
    star_name = star[&#39;ProperName&#39;]
    unless star_name goto LOAD_NEXT_STAR
    if star_name goto DISPLAY_STAR_DETAILS
    unnamed_match_count += 1
    goto LOAD_NEXT_STAR

  DISPLAY_STAR_DETAILS:
    say_star_details(star)
    goto LOAD_NEXT_STAR

  END:
    close data_file
    print matching_count
    print &#34; stars exactly matched Sol&#39;s spectrum &#34;
    say sol_spectrum
    print unnamed_match_count
    say &#39; have no proper name&#39;

.end

.sub extract_star_details
    .param pmc headers
    .param pmc values

    .local pmc star
    .local int header_count
    .local string current_header
    .local string current_value
    .local int current_index

    current_index = 0
    header_count = headers
    star = new &#39;Hash&#39;

  ASSIGN_NEXT_STAR_FIELD:
    if current_index &gt;= header_count goto RETURN_STAR
    current_header = headers[current_index]
    current_value = values[current_index]
    star[current_header] = current_value
    current_index += 1
    goto ASSIGN_NEXT_STAR_FIELD


  RETURN_STAR:
    .return(star)
.end

.sub say_star_details
    # ...
.end
</code></pre><p>The code is starting to get a little long, so I am adopting the habit
of replacing subroutine blocks with <code># ...</code> when the code is unchanged from
the previous example.</p>
<p>Most of the code in our new <code>extract_star_details</code> subroutine looks familiar, but we do
have one noteworthy addition:</p>
<pre tabindex="0"><code>.return(star)
</code></pre><p>This directive hands the Hash we&rsquo;ve just built back to whoever called the function.</p>
<p>Is our application cleaner? Yes, a little bit. I&rsquo;m tired of having so many unnamed
stars, though. Let&rsquo;s add a little logic to attempt an alternate name if no proper
name is available.</p>
<h3 id="making-say_star_details-smarter">Making <code>say_star_details</code> Smarter</h3>
<pre tabindex="0"><code># example-07-03
.sub &#39;main&#39; :main

    load_bytecode &#39;String/Utils.pbc&#39;

    .const string DELIMITER  = &#39;,&#39;
    .local pmc    chomp
    .local string filename
    .local pmc    data_file
    .local string current_line
    .local pmc    field_names
    .local pmc    star_data
    .local pmc    star
    .local string star_spectrum
    .local pmc    sol
    .local string sol_spectrum
    .local int    matching_count

    chomp         = get_global [&#39;String&#39;;&#39;Utils&#39;], &#39;chomp&#39;
    filename      = &#39;hygxyz.csv&#39;
    data_file     = open filename, &#39;r&#39;
    current_line  = readline data_file
    current_line  = chomp(current_line)
    field_names   = split DELIMITER, current_line

    current_line = readline data_file
    current_line = chomp(current_line)
    star_data = split DELIMITER, current_line
    sol = extract_star_details(field_names, star_data)

  FIND_MATCHING_STARS:
    sol_spectrum = sol[&#39;Spectrum&#39;]
    matching_count = 0
    # We want to show Sol&#39;s details as well as other matches.
    say_star_details(sol)

  LOAD_NEXT_STAR:
    unless data_file goto END
    current_line = readline data_file
    current_line = chomp(current_line)
    star_data    = split DELIMITER, current_line
    star         = extract_star_details(field_names, star_data)

  EXAMINE_STAR:
    star_spectrum = star[&#39;Spectrum&#39;]
    if star_spectrum == sol_spectrum goto REMEMBER_MATCH
    goto LOAD_NEXT_STAR

  REMEMBER_MATCH:
    matching_count += 1
    say_star_details(star)
    goto LOAD_NEXT_STAR

  END:
    close data_file
    print matching_count
    print &#34; stars exactly matched Sol&#39;s spectrum &#34;
    say sol_spectrum
.end

.sub extract_star_details
    # ...
.end

.sub say_star_details
    .param pmc star

    .local string star_name
    .local string star_spectrum
    .local string star_distance

    star_name = star[&#39;ProperName&#39;]
    star_spectrum = star[&#39;Spectrum&#39;]
    star_distance = star[&#39;Distance&#39;]

    if star_name goto DISPLAY_DETAILS

  TRY_GLIESE:
    .local string gliese_number
    gliese_number = star[&#39;Gliese&#39;]
    unless gliese_number goto TRY_BAYER_FLAMSTEED
    star_name = &#39;Gliese &#39; . gliese_number
    goto DISPLAY_DETAILS

  TRY_BAYER_FLAMSTEED:
    .local string bayer_flamsteed
    bayer_flamsteed = star[&#39;BayerFlamsteed&#39;]
    unless bayer_flamsteed goto TRY_HR
    star_name = &#34;BF &#34; . bayer_flamsteed
    goto DISPLAY_DETAILS

  TRY_HR:
    .local string hr_id
    hr_id = star[&#39;HR&#39;]
    unless hr_id goto TRY_HD
    star_name = &#34;HR &#34; . hr_id
    goto DISPLAY_DETAILS

  TRY_HD:
    .local string hd_id
    hd_id = star[&#39;HD&#39;]
    unless hd_id goto USE_STAR_ID
    star_name = &#34;HD &#34; . hd_id
    goto DISPLAY_DETAILS

  TRY_HIP:
    .local string hip_id
    hip_id = star[&#39;HIP&#39;]
    unless hip_id goto USE_STAR_ID
    star_name = &#34;HIP &#34; . hip_id
    goto DISPLAY_DETAILS

  USE_STAR_ID:
    .local string star_id
    star_id = star[&#39;StarID&#39;]
    star_name = &#34;HYG &#34; . star_id
    goto DISPLAY_DETAILS

  DISPLAY_DETAILS:
    print &#34;&lt;Name: &#34;
    print star_name
    print &#34;, Spectrum: &#34;
    print star_spectrum
    print &#34;, Distance: &#34;
    print star_distance
    say &#34;&gt;&#34;
.end
</code></pre><p>Now <em>this</em> version of the app displays everything along with some kind of
designation. The order I look for names is arbitrary, and is based
roughly in order of how familiar they looked to me. The tediousness of
determining which reference to use has been hidden away in the <code>say_star_details</code>
subroutine, and consists of simply checking each field for a value until
something useful is found. I knew there would be some kind of name to display,
so I removed the name-counting functionality from <code>main</code>.</p>
<pre tabindex="0"><code>$ parrot example-07-03.pir | more
# ... much text omitted
&lt;Name: HYG 117782, Spectrum: G2V, Distance: 139.275766016713&gt;
&lt;Name: HD 224693, Spectrum: G2V, Distance: 94.0733772342427&gt;
568 stars exactly matched Sol&#39;s spectrum G2V
</code></pre><h2 id="conclusion">Conclusion</h2>
<p>Right. Our script has grown to the point where it shows every <code>G2V</code> star
in the HYG database, and some of the complexity of this task has been
tucked away behind subroutines. Is there more to be done? You bet! I would
love to add user search features to the code. That&rsquo;s going to a fair step
on its own, so I think I will close my Vim window and push this page.</p>

  




  <section class="backlinks">
    <h2>Backlinks</h2>
    <nav>
      <ul>
      
      <li>
        <a href="/post/2010/10/parrot-babysteps-0e-parrot-namespaces/">parrot-babysteps-0e-parrot-namespaces</a>
      </li>
      
      </ul>
    </nav>
  </section>



  <hr>
  

  
  
<hr>
<div class="footer">
    
      <p>Series: <a href="/series/parrot-babysteps">Parrot Babysteps</a></p>
    
    
      <a class="previous-post" href="https://randomgeekery.org/post/2009/10/parrot-babysteps-06-files-and-hashes/?ref=footer">
        <span style="font-weight:bold;">« Previous</span>
        <br>Parrot Babysteps 06 - Files and Hashes
      </a>
    
    
      <div class="next-post">
        <a href="https://randomgeekery.org/post/2009/12/nqp-not-quite-perl/?ref=footer">
          <span style="font-weight:bold;">Next »</span>
          <br>NQP - Not Quite Perl
        </a>
      </div>
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#subroutines">Subroutines</a></li>
    <li><a href="#returning-values">Returning Values</a>
      <ul>
        <li><a href="#making-say_star_details-smarter">Making <code>say_star_details</code> Smarter</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div><script defer data-domain="randomgeekery.org" src="https://plausible.io/js/script.js"></script>
    </body>
</html>
