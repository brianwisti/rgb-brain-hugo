<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.60856f0f2ed73fb3cd2820ee548c4698ffbc4d743736e852c0e27ce4f52dfd9c.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  

<meta property="og:url" content="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/">
<meta property="og:title" content="Trying the Crystal Language">
<meta name="twitter:title" content="Trying the Crystal Language">


  <meta name="twitter:site" content="@brianwisti">



  
    <meta name="twitter:description" content="In which I use Crystal for a simple shell task">
    <meta property="og:description" content="In which I use Crystal for a simple shell task">
  



<title itemprop="name">Trying the Crystal Language - Random Geekery</title>
<meta property="og:title" content=Trying&#32;the&#32;Crystal&#32;Language&#32;-&#32;Random&#32;Geekery />
<meta name="twitter:title" content=Trying&#32;the&#32;Crystal&#32;Language&#32;-&#32;Random&#32;Geekery />
<meta itemprop="name" content=Trying&#32;the&#32;Crystal&#32;Language&#32;-&#32;Random&#32;Geekery />
<meta name="application-name" content=Trying&#32;the&#32;Crystal&#32;Language&#32;-&#32;Random&#32;Geekery />
<meta property="og:site_name" content="Random Geekery" />


<meta name="description" content="In which I use Crystal for a simple shell task" />
<meta itemprop="description" content="In which I use Crystal for a simple shell task" />
<meta property="og:description" content="In which I use Crystal for a simple shell task" />
<meta name="twitter:description" content="In which I use Crystal for a simple shell task" />


<base href="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/" />
<link rel="canonical" href="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/" itemprop="url" />
<meta name="url" content="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/" />
<meta name="twitter:url" content="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/" />
<meta property="og:url" content="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/" />


<meta property="og:updated_time" content=25008-25-12T80:00:19-0700 />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://randomgeekery.org/sitemap.xml' />

  <link
      rel="alternate"
      type="application/rss+xml"
    
        href="/index.xml"
    
      title="Random Geekery"/>



<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Random Geekery" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.121.2">


    
    

<link
    rel="stylesheet"
    href="/css/style.15361b4c24f30033251cd8947e34c41e754c9461dc117cab390ac04e365faec3.css"
    integrity="sha256-FTYbTCTzADMlHNiUfjTEHnVMlGHcEXyrOQrATjZfrsM=" 
    crossorigin="anonymous">


</head>

    <body class="">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://randomgeekery.org">
                <h1>Random Geekery</h1>
            </a>
        
    </h1>
    <p class="lead">
    Collecting my attempts to improve at tech, art, and life
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">
      
        <li class="bullet">
          <a href="/follow/">Follow</a>
        </li>
      
        <li class="bullet">
          <a href="/now/">Now</a>
        </li>
      
    </ul>
</nav>

        
  <div class="related">
    <div class="related-posts">
      <h3>Related</h3>
      <ul>
        
          <li><a href="/post/2019/11/directory-listings-with-crystal/">Directory Listings With Crystal</a></li>
        
          <li><a href="/post/2019/11/summarizing-a-file-with-crystal/">Summarizing A File With Crystal</a></li>
        
          <li><a href="/post/2021/02/got-different-benchmarks-from-programming-crystal/">Got different benchmarks from Programming Crystal</a></li>
        
          <li><a href="/post/2020/01/a-quick-notes-script-for-taskwarrior/">A Quick Notes Script for Taskwarrior</a></li>
        
          <li><a href="/post/2019/12/dwim-is-consistent/">DWIM is consistent</a></li>
        
      </ul>
    </div>
  </div>



        
















        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Brian Wisti. All rights reserved.
</p>
<p class="footnote">
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
  </a>.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <nav class="masthead">
    <ul>
    
  
    
  
    
  

    <li><a href="https://randomgeekery.org/">Random Geekery</a></li>
  

    <li><a href="https://randomgeekery.org/post/">Posts</a></li>
  

    <li><a class="active" href="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/">Trying the Crystal Language</a></li>
</nav>



  <div class="info">
    <h1 class="post-title">
        <a href="https://randomgeekery.org/post/2019/08/trying-the-crystal-language/">Trying the Crystal Language</a>
    </h1>
    
        <time datetime="2019-08-25T00:00:00-0700" class="post-date">
            August 25, 2019
        </time>
    
    
    <ul class="tags">
        
        <li class="tag-crystal">
            <a href="https://randomgeekery.org/tags/crystal">crystal</a>
        </li>
        
        <li class="tag-taskwarrior">
            <a href="https://randomgeekery.org/tags/taskwarrior">taskwarrior</a>
        </li>
        
        <li class="tag-programming">
            <a href="https://randomgeekery.org/tags/programming">programming</a>
        </li>
        
    </ul>
    
    
    
    
    
    
</div>

  <p><img src="/post/2019/08/../../../attachments/img/2019/cover-2019-08-25.png" alt="attachments/img/2019/cover-2019-08-25.png"/></p>
<p><a href="/card/crystal/">card/Crystal</a> is a statically typed, compiled programming language that looks a <em>lot</em> like <a href="/card/ruby/">card/Ruby</a>. Let’s try it out! Maybe even work on a <a href="/card/taskwarrior/">Taskwarrior</a> thing I’ve been wanting to do.</p>
<h2 id="motivation">Motivation</h2>
<p>I want to play with a compiled language, but I’m not in the mood for Go or Rust.</p>
<p>Crystal looks friendly. Similar syntax to Ruby. Statically typed, ruling out a category of silly mistakes I always make (passing the wrong kind of value). Uses type inference, which means it can figure out what type a variable is without us telling it. Compiled, so you can run things quicker than in Ruby.</p>
<p>The philosophy summarized on the front page of the Crystal home page is &ldquo;Fast as C, slick as Ruby&rdquo;. That works for me.</p>
<p>I don’t care if it compiles super fast or the executable is super fast. An executable that runs quicker than my utility scripts, written in a language just as friendly, will be nice.</p>
<h2 id="installation">Installation</h2>
<p>The documentation provides instructions on <a href="https://crystal-lang.org/reference/installation/">how to install Crystal</a> across
several platforms. Today I’m on my Windows partition. Though they’re working on a full Windows port, the best path for now is to use <a href="https://brew.sh/">Homebrew</a> on <em>inbox/WSL</em>.</p>
<pre tabindex="0"><code>$ brew install crystal
...
$ crystal version
Crystal 0.30.1 (2019-08-15)
LLVM: 8.0.1
Default target: x86_64-unknown-linux-gnu
</code></pre><p><code>crystal</code> provides a collection of subcommands.</p>
<pre tabindex="0"><code>$ crystal help

Usage: crystal [command] [switches] [program file] [--] [arguments]

Command:
    init                     generate a new project
    build                    build an executable
    docs                     generate documentation
    env                      print Crystal environment information
    eval                     eval code from args or standard input
    play                     starts Crystal playground server
    run (default)            build and run program
    spec                     build and run specs (in spec directory)
    tool                     run a tool
    help, --help, -h         show this help
    version, --version, -v   show version
</code></pre><p>Oh my there are some interesting commands in there! I’ll just focus on the ones that result in me running code.</p>
<h2 id="one-liners-with-eval">One-liners with <code>eval</code></h2>
<p>Crystal does not ship with an interactive shell. Makes sense, considering that it’s supposed to be a compiled language. Still, it’s more flexible than I expected. If all I want is a one-liner, Crystal can do that!</p>
<pre tabindex="0"><code>$ crystal eval &#39;puts &#34;Hi!&#34;&#39;
Hi!
</code></pre><p>Okay, that wasn’t super exciting. What about pretty-printing the current environment variables?</p>
<pre tabindex="0"><code>$ crystal eval &#39;pp ENV&#39;
{&#34;BF&#34; =&gt; &#34;$albumartist | $album | $track/$tracktotal | $title&#34;,
&#34;BREW_PREFIX&#34; =&gt; &#34;/home/linuxbrew/.linuxbrew&#34;,
&#34;CLICOLOR&#34; =&gt; &#34;1&#34;,
...
&#34;_&#34; =&gt; &#34;/home/linuxbrew/.linuxbrew/bin/crystal&#34;,
&#34;wg_date&#34; =&gt; &#34;#[]%Y-%m-%d %H:%M%z#[default]&#34;}
</code></pre><p><a href="https://crystal-lang.org/api/ENV.html">ENV</a> is a Hash-like accessor. You can access and iterate through environment variables as if they were keys in a Hash.</p>
<pre tabindex="0"><code>$ crystal eval &#39;ENV.each { |k, v| puts &#34;#{k}: #{v}&#34; }&#39;
</code></pre><p>Except that the <code>pp</code> output was sorted. That’s fine. We’ll sort the keys.</p>
<pre tabindex="0"><code>$ crystal eval &#39;ENV.keys.sorted.each { |k| puts &#34;#{k}: #{ENV[k]}&#34; }&#39;
</code></pre><p>Printing data as JSON is a pretty common task. Common enough that it’s a Hash method here. Except ENV isn’t a <a href="https://crystal-lang.org/api/Hash.html">Hash</a>. It’s a &ldquo;Hash-like accessor.&rdquo;</p>
<p>No problem, we can make a Hash from <code>ENV</code>.</p>
<pre tabindex="0"><code>$ crystal eval &#39;require &#34;json&#34;; env = Hash.zip(ENV.keys, ENV.values); puts env.to_json&#39;
{&#34;NVM_DIR&#34;:&#34;/home/random/.nvm&#34;,&#34;HOSTTYPE&#34;:&#34;x86_64&#34;,&#34;PYENV_HOME&#34;:&#34;/home/random/.pyenv&#34;, ...
&#34;WSLENV&#34;:&#34;&#34;,&#34;_&#34;:&#34;/home/linuxbrew/.linuxbrew/bin/crystal&#34;}
</code></pre><p>Well. I lost my sorting and the JSON isn’t exactly pretty-printed. I know I can fix this from inside Crystal, but my one-liner would get clunky. Hey, this is a one-liner. Let’s pipe it to <a href="https://stedolan.github.io/jq/">jq</a>!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> crystal <span class="nb">eval</span> <span class="s1">&#39;require &#34;json&#34;; env = Hash.zip(ENV.keys, ENV.values); puts env.to_json&#39;</span> <span class="p">|</span> jq --sort-keys <span class="s1">&#39;.&#39;</span>
</span></span></code></pre></div><p>There, now it’s all pretty-printed.</p>
<p><img src="/post/2019/08/attachments/img/2019/crystal-env-jq.png" alt="Colorized JSON via jq"/></p>
<p>One-liners are fun.</p>
<p>What was I doing next? Oh right. Crystal source files.</p>
<h2 id="shell-scripts-with-run">Shell scripts with <code>run</code></h2>
<p>I have no idea how to do dependency management in Crystal yet. Something
about <a href="https://crystal-lang.org/reference/the_shards_command/">shards</a>. But even stock Crystal looks like it would work as a glue language for shell scripts. Plus, the <code>run</code> command lets you ignore the build process and pretend your code is being run directly.</p>
<p><strong><code>hello-user.cr</code></strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env crystal</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s2">&#34;Who are you? &#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="nb">gets</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;USER&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="nb">puts</span> <span class="s2">&#34;Hey there </span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">tasks</span> <span class="o">=</span> <span class="sb">`task +DUE count`</span><span class="o">.</span><span class="n">to_i</span>
</span></span><span class="line"><span class="cl">  <span class="nb">puts</span> <span class="s2">&#34;You have </span><span class="si">#{</span><span class="n">tasks</span><span class="si">}</span><span class="s2"> tasks due.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">puts</span> <span class="s2">&#34;Better get on it!&#34;</span> <span class="k">if</span> <span class="n">tasks</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="nb">puts</span> <span class="s2">&#34;I was not expecting you to say </span><span class="se">\&#34;</span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="se">\&#34;</span><span class="s2">!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><ul>
<li>Since <code>run</code> is the default command, you could make a plain old Crystal script! What can I say, I like the old ways.</li>
<li>Crystal ignores trailing whitespace in <code>to_i</code>. You’ll still want to <code>chomp</code> when examining the output of a command.</li>
</ul>
<pre tabindex="0"><code>$ chmod 700 hello-user.cr
$ ./hello-user.cr
Who are you? random
Hey there random!
You have 3 tasks due.
Better get on it!
</code></pre><p>Remember, this is just me using <code>#!</code> to say <code>crystal run hello-user.cr</code></p>
<p>It looks a <em>lot</em> like Ruby. You could take out that <code>#!</code> and it would <em>almost</em> work as-is.</p>
<pre tabindex="0"><code>$ ruby hello-user.cr
Who are you? random
I was not expecting you to say &#34;random
&#34;!
</code></pre><p>Almost.</p>
<h2 id="build"><code>build</code></h2>
<p>Okay, directly running scripts is great for testing or quick tasks, but Crystal <em>is</em> a compiled language. Let’s compile something.</p>
<p><a href="https://twitter.com/pjf/status/852466839145795584">Paul Fenwick</a> and <a href="https://jacoby.github.io/2017/10/25/making-taskwarrior-work-for-me.html">Dave Jacoby</a> have — or had, no idea if they still do — a neat trick to show quick task status in their shell prompt. I’ll do the same thing, but in Crystal.</p>
<p><strong><code>task-indicator.cr</code></strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="line"><span class="cl"><span class="no">URGENT</span>       <span class="o">=</span> <span class="sc">&#39;\u{2757}&#39;</span>  <span class="c1"># exclamation</span>
</span></span><span class="line"><span class="cl"><span class="no">DUE_TOMORROW</span> <span class="o">=</span> <span class="sc">&#39;\u{1f4c5}&#39;</span> <span class="c1"># calendar</span>
</span></span><span class="line"><span class="cl"><span class="no">DUE_TODAY</span>    <span class="o">=</span> <span class="sc">&#39;\u{1f631}&#39;</span> <span class="c1"># screaming</span>
</span></span><span class="line"><span class="cl"><span class="no">OVERDUE</span>      <span class="o">=</span> <span class="sc">&#39;\u{2620}&#39;</span>  <span class="c1"># ded</span>
</span></span><span class="line"><span class="cl"><span class="no">OK</span>           <span class="o">=</span> <span class="s2">&#34;$&#34;</span>         <span class="c1"># normal</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">has_ready_tasks</span><span class="p">(</span><span class="n">extra_filter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="sb">`task +READY </span><span class="si">#{</span><span class="n">extra_filter</span><span class="si">}</span><span class="sb"> count`</span><span class="o">.</span><span class="n">to_i</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">task_indicator</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span>
</span></span><span class="line"><span class="cl">  <span class="k">when</span> <span class="n">has_ready_tasks</span><span class="p">(</span><span class="s2">&#34;+OVERDUE&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="no">OVERDUE</span>
</span></span><span class="line"><span class="cl">  <span class="k">when</span> <span class="n">has_ready_tasks</span><span class="p">(</span><span class="s2">&#34;+TODAY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="no">DUE_TODAY</span>
</span></span><span class="line"><span class="cl">  <span class="k">when</span> <span class="n">has_ready_tasks</span><span class="p">(</span><span class="s2">&#34;+TOMORROW&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="no">DUE_TOMORROW</span>
</span></span><span class="line"><span class="cl">  <span class="k">when</span> <span class="n">has_ready_tasks</span><span class="p">(</span><span class="s2">&#34;urgency </span><span class="se">\\</span><span class="s2">&gt; 10&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="no">URGENT</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;$&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="n">task_indicator</span>
</span></span></code></pre></div><p>Does it work?</p>
<pre tabindex="0"><code>$ crystal run task-indicator.cr
{{}}
</code></pre><p>Yeah, I know. I’m working on it. <em>Anyways</em> let’s build this thing.</p>
<pre tabindex="0"><code>$ crystal build task-indicator.cr
$ ls -lhF
total 1.3M
-rwxrwxr-x 1 random random 1.3M Aug 25 14:17 task-indicator*
-rw-rw-r-- 1 random random  546 Aug 25 14:05 task-indicator.cr
</code></pre><p>There’s a new executable called <code>task-indicator</code>. It’s not exactly small, but it produces the same output. Yes, the screaming face.</p>
<h2 id="build---release"><code>build --release</code></h2>
<p>The default build includes a lot of debugging information that I won’t need in my daily usage. I’ll make a release version.</p>
<pre tabindex="0"><code>$ crystal build --release task-indicator.cr -o task-indicator-release
$ ls -lhF
total 2.0M
-rwxrwxr-x 1 random random 1.3M Aug 25 14:17 task-indicator*
-rwxrwxr-x 1 random random 665K Aug 25 14:23 task-indicator-release*
-rw-rw-r-- 1 random random  546 Aug 25 14:05 task-indicator.cr
</code></pre><p>I didn’t <em>have</em> to give it a different name. I wanted to see the size difference between debug and release builds.</p>
<pre tabindex="0"><code>$ cp task-indicator-release ~/bin/task-indicator
</code></pre><p>Then over in my <code>.bashrc</code>:</p>
<p><strong><code>~/.bashrc</code></strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Terminal colours (after installing GNU coreutils)</span>
</span></span><span class="line"><span class="cl"><span class="nv">NM</span><span class="o">=</span><span class="s2">&#34;\[\033[0;38m\]&#34;</span>  <span class="c1"># means no background and white lines</span>
</span></span><span class="line"><span class="cl"><span class="nv">HI</span><span class="o">=</span><span class="s2">&#34;\[\033[0;34m\]&#34;</span>  <span class="c1"># change this for username letter colors</span>
</span></span><span class="line"><span class="cl"><span class="nv">HII</span><span class="o">=</span><span class="s2">&#34;\[\033[0;31m\]&#34;</span> <span class="c1"># change this for hostname letter colors</span>
</span></span><span class="line"><span class="cl"><span class="nv">SI</span><span class="o">=</span><span class="s2">&#34;\[\033[0;33m\]&#34;</span>  <span class="c1"># this is for the current directory</span>
</span></span><span class="line"><span class="cl"><span class="nv">IN</span><span class="o">=</span><span class="s2">&#34;\[\033[0;0m\]&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">PS1</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$NM</span><span class="s2">[ </span><span class="nv">$HI</span><span class="s2">\u </span><span class="nv">$SI</span><span class="s2">\w</span><span class="nv">$NM</span><span class="s2"> ] \$(__git_ps1) </span><span class="nv">$IN</span><span class="s2">\n\$(task-indicator) &#34;</span>
</span></span></code></pre></div><p><img src="/post/2019/08/attachments/img/2019/run-task-indicator.png" alt="Output of task-indicator.cr showing something due today"/></p>
<p>Nice.</p>
<p>At first I put the output of <code>task-indicator</code> in a variable, and put the variable in <code>$PS1</code>. Except that variable was only evaluated on shell start. Instead put the invocation directly in <code>$PS1</code> with a leading backslash. Now the indicator is live, as I expected it to be.</p>
<h2 id="done">Done!</h2>
<p>I wanted to learn some basic Crystal usage and find ways to work the language into my daily shell routine. With <code>eval</code>, <code>run</code>, and <code>build</code> all at my disposal, it sure looks like a success! I even used Crystal to make a Taskwarrior indicator, which has been on my task list since last year.</p>
<p>I don’t know yet if Crystal is <em>better</em> than Ruby. Even at this early point it’s just as useful and just as much fun. Since &ldquo;be useful and have fun&rdquo; is a major thing for me, I’ll be exploring Crystal more!</p>

  




  <section class="backlinks">
    <h2>Backlinks</h2>
    <nav>
      <ul>
      
      <li>
        <a href="/post/2019/11/summarizing-a-file-with-crystal/">summarizing-a-file-with-crystal</a>
      </li>
      
      </ul>
    </nav>
  </section>



  <hr>
  

  
    <section>
      <p>
        Got a comment? A question? More of a comment than a question?
      </p>
      <p>
        Talk to me about this page on:
        
          
            <a
              href="https://hackers.town/@randomgeek/102680987046371636"
              class="u-syndication label centered fa fa-mastodon"
              title="Mastodon"
              rel="syndication"
              aria-label="Mastodon"
            >
              <span class="sr-only">mastodon</span>
            </a>
          
        
          
        
      </p>
    </section>
  
  
<hr>
<div class="footer">
    
    
      <a class="previous-post" href="https://randomgeekery.org/post/2019/08/chaotic-symmetry/?ref=footer">
        <span style="font-weight:bold;">« Previous</span>
        <br>Chaotic Symmetry
      </a>
    
    
      <div class="next-post">
        <a href="https://randomgeekery.org/post/2019/08/yanick-made-me-do-it/?ref=footer">
          <span style="font-weight:bold;">Next »</span>
          <br>Yanick made me do it
        </a>
      </div>
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#motivation">Motivation</a></li>
    <li><a href="#installation">Installation</a></li>
    <li><a href="#one-liners-with-eval">One-liners with <code>eval</code></a></li>
    <li><a href="#shell-scripts-with-run">Shell scripts with <code>run</code></a></li>
    <li><a href="#build"><code>build</code></a></li>
    <li><a href="#build---release"><code>build --release</code></a></li>
    <li><a href="#done">Done!</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div><script defer data-domain="randomgeekery.org" src="https://plausible.io/js/script.js"></script>
    </body>
</html>
